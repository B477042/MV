//================================================================
// RS_MessageEffects.js
// ---------------------------------------------------------------
// The MIT License
// Copyright (c) 2020 biud436
// ---------------------------------------------------------------
// Free for commercial and non commercial use.
//================================================================
/*:
 * @plugindesc <RS_MessageEffects>
 * @author biud436
 * 
 * @param Default Text Effect
 * @type select
 * @desc Select desired text effect.
 * @default normal_rot
 * @option Ping Pong
 * @value pingpong
 * @option Slide
 * @value slide
 * @option high_rot
 * @value high_rot
 * @option normal_rot
 * @value normal_rot
 * @option random_rot
 * @value random_rot
 * @option None
 * @value none
 * 
 * @param New Page
 * 
 * @param Clear Flag
 * @parent New Page
 * @type boolean
 * @desc Clear the text effect as 'none' when opening a new page
 * @default false
 * @on true
 * @off false
 *          
 * @help
 * This help document does not support English translation yet.
 * This plugin is also incompatible with the YEP_MessageCore plugin.
 * 
 * ================================================================
 * 소개
 * ================================================================
 * 이 플러그인은 한글 메시지 시스템 플러그인과 호환됩니다.
 * 따로 부가 플러그인으로 내놓는 이유는 성능적 저하가 심하기 때문입니다.
 * 메인 플러그인에 이런 텍스트 기능을 넣게 되면 심각한 성능 저하가 올 수 있습니다.
 * 
 * 또한 Visual Novel Maker의 Design Pattern과 유사하게 상속 방식으로 개발하였습니다.
 * 따라서 이 플러그인은 RPG Maker MV v1.6.2 이상에서만 지원합니다.
 * 
 * 그러나 상속 방식의 패턴이 만드는 프로토타입 체인의 성능적 저하는 측정 및 검증되지 않았습니다.
 * 
 * 이외에도 성능적 저하의 요소는 더 있습니다.
 * 
 * //!! 성능 저하 요소 1
 * 텍스트는 캔버스를 생성한 후 동적으로 Texture를 만들고 GPU로 매 글자마다
 * 새로운 Texture를 업로드를 하게 됩니다.
 * 
 * 각 글자를 새로운 Texture로 형성해야 하므로 최적화에 좋지 않습니다.
 * 
 * 가장 좋은 방법은 Bitmap Text를 사용하여 미리 업로드된 Texture를 사용하는
 * 방식입니다.
 * 
 * 이렇게 하면 Draw Call이 추가로 들지 않습니다.
 * Bitmap Text는 글꼴 형성에 큰 제한이 있으므로 아직까지 지원하진 않습니다.
 * 
 * 따라서 PC가 아니라면 이 플러그인은 사용하기 부적절합니다.
 * 모바일에서는 사용을 하지 마시기 바랍니다.
 * 
 * //!! 성능 저하 요소 2
 * Draw Call 문제 이외에도, 이 플러그인은 대부분 삼각 함수를 이용하여 
 * 계산을 하고 있습니다.
 * 
 * 삼각 함수는 CPU에 부담을 주며 실제로 성능이 저하될 수 있습니다.
 * 성능 저하 시기는 대화창 페이지가 새로 형성될 때 입니다.
 * 
 * 삼각 함수는 업데이트 이전에 작성된 데이터를 사용하면 좋겠으나,
 * 실시간으로 데이터를 바꿔야 하므로 페이지가 열려있을 땐 매 시간 계산됩니다.
 * 
 * //!! 성능 저하 요소 3
 * 자바스크립트에서는 아직 C# 코루틴 같은 재진입 요소를 사용하기가 까다롭기 때문에,
 * 프레임워크 내에서 한시적으로 오브젝트를 업데이트를 시키는 것이 힘이 듭니다.
 * 
 * 따라서 페이지가 열려있을 때 글자 갯수마다 의미 없는 오브젝트 업데이트 함수가 호출됩니다.
 * 
 * 물론 이를 해결할 방법은 있습니다.
 * 텍스트 묘화가 끝난 후, 하나의 텍스쳐로 업로드를 하거나 
 * Ticker나 Event Listener 등으로 한시적 업데이트를 구현하는 것입니다.
 * 
 * 그러나 이렇게 검증되지 않은 방식에 투자할 시간은 없습니다.
 * 
 * ================================================================
 * Text Codes
 * ================================================================
 * 다음과 같은 텍스트 코드를 사용할 수 있습니다.
 * 
 *  \텍스트효과<효과명>
 *  \TE<TEXT_EFFECT_NAME>
 * 
 * 다음 명령은 부드럽게 상하로 부드럽게 흔들리는 이펙트를 줍니다.
 * 
 * \텍스트효과<pingpong>
 * \TE<pingpong>
 * 
 * 다음 명령은 투명도 증감과 함께 좌우로 살짝 흔들리는 이펙트를 줍니다.
 * 
 * \텍스트효과<slide>
 * \TE<slide>
 * 
 * 글자가 어딘가에서 날라와 제자리를 빠르게 찾아갑니다.
 * 
 * \텍스트효과<high_rot>
 * \TE<high_rot>
 * 
 * 규칙적으로 방향도 전환하면서 제자리를 찾는 효과입니다.
 * 
 * \텍스트효과<normal_rot>
 * \TE<normal_rot>
 * 
 * 불규칙적인 패턴으로 제자리를 찾아갑니다.
 * 
 * \텍스트효과<random_rot>
 * \TE<random_rot>
 * 
 * 이외로 텍스트 효과를 없애고 싶다면 다음과 같습니다.
 * 
 * \텍스트효과<none>
 * \TE<none>
 * 
 * 주의할 점은 텍스트 효과 문자열은 대소문자를 구분한다는 점입니다.
 * 
 * ================================================================
 * Plugin Commmands
 * ================================================================
 * 다음 명령은 부드럽게 상하로 부드럽게 흔들리는 이펙트를 줍니다.
 * 
 * MessageEffectMap pingpong
 * 
 * 다음 명령은 투명도 증감과 함께 좌우로 살짝 흔들리는 이펙트를 줍니다.
 * 
 * MessageEffectMap slide
 * 
 * 글자가 어딘가에서 날라와 제자리를 빠르게 찾아갑니다.
 * 
 * MessageEffectMap high_rot
 * 
 * 규칙적으로 방향도 전환하면서 제자리를 찾는 효과입니다.
 * 
 * MessageEffectMap normal_rot
 * 
 * 불규칙적인 패턴으로 제자리를 찾아갑니다.
 * 
 * MessageEffectMap random_rot
 * 
 * 대소문자를 구분하므로 소문자를 대문자를 적지 않도록 해주세요.
 * 
 */ 
!function(g){var I={};function t(c){if(I[c])return I[c].exports;var C=I[c]={i:c,l:!1,exports:{}};return g[c].call(C.exports,C,C.exports,t),C.l=!0,C.exports}t.m=g,t.c=I,t.d=function(g,I,c){t.o(g,I)||Object.defineProperty(g,I,{enumerable:!0,get:c})},t.r=function(g){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})},t.t=function(g,I){if(1&I&&(g=t(g)),8&I)return g;if(4&I&&"object"==typeof g&&g&&g.__esModule)return g;var c=Object.create(null);if(t.r(c),Object.defineProperty(c,"default",{enumerable:!0,value:g}),2&I&&"string"!=typeof g)for(var C in g)t.d(c,C,function(I){return g[I]}.bind(null,C));return c},t.n=function(g){var I=g&&g.__esModule?function(){return g.default}:function(){return g};return t.d(I,"a",I),I},t.o=function(g,I){return Object.prototype.hasOwnProperty.call(g,I)},t.p="",t(t.s=1)}([function(module,exports){eval('window.Imported = window.Imported || {};\r\nImported.RS_MessageEffects = true;\r\n\r\nwindow.RS = window.RS || {};\r\nwindow.RS.MessageEffects = window.RS.MessageEffects || {};\r\n\r\nvar parameters = $plugins.filter(function (i) {\r\n  return i.description.contains(\'<RS_MessageEffects>\');\r\n});\r\n\r\nparameters = (parameters.length > 0) && parameters[0].parameters;\r\n\r\nRS.MessageEffects.Params = {};\r\n\r\nRS.MessageEffects.Params.defaultTextEffect = parameters["Default Text Effect"] || "none";\r\nRS.MessageEffects.Params.currentEffect = RS.MessageEffects.Params.defaultTextEffect;\r\nRS.MessageEffects.Params.clearFlag = Boolean(parameters["Clear Flag"] === "true");\r\n\r\n//================================================================\r\n// Window_MessageImpl\r\n//================================================================    \r\nclass Window_MessageImpl extends Window_Message {\r\n    constructor() {\r\n        super();\r\n\r\n        this.createMainTextLayer();\r\n        // this.createRenderTexture();\r\n\r\n        this.once("removed", () => {\r\n            this.terminateMainTextLayer();\r\n        });\r\n\r\n    }\r\n\r\n    // createRenderTexture() {\r\n    //     const gl = Graphics._renderer.gl;\r\n    \r\n    //     // Create RenderTexture\r\n    //     this._renderTexture = PIXI.RenderTexture.create(\r\n    //         this.width,\r\n    //         this.height,\r\n    //         PIXI.SCALE_MODES.NEAREST\r\n    //     );\r\n    \r\n    //     // Create RenderTarget\r\n    //     if(Graphics.isWebGL()) {\r\n    //         this._renderTarget = new PIXI.RenderTarget(\r\n    //             gl, \r\n    //             this.width,\r\n    //             this.height,\r\n    //             PIXI.SCALE_MODES.NEAREST\r\n    //         );\r\n    //     } else {\r\n    //         this._renderTarget = new PIXI.CanvasRenderTarget(this.width, this.height);\r\n    //     }\r\n    \r\n    //     // Create Sprite\r\n    //     this._renderSprite = new Sprite();\r\n\r\n    //     this.on("removed", this.destroyRenderTexture, this);\r\n\r\n    //     this._init = true;\r\n\r\n    // }\r\n\r\n    // destroyRenderTexture() {\r\n    //     if( this._renderTexture ) this._renderTexture.destroy({ destroyBase: true });\r\n    //     if( this._renderSprite ) this._renderSprite.destroy({ children: true });\r\n    //     if( this._renderTarget ) this._renderTarget.destroy();\r\n    //     this._renderTexture = null;\r\n    //     this._renderSprite = null;\r\n    //     this._renderTarget = null;     \r\n    // }\r\n\r\n    clearFlags() {\r\n        super.clearFlags();\r\n        if(RS.MessageEffects.Params.clearFlag) {\r\n            RS.MessageEffects.Params.currentEffect = \'none\';\r\n        }\r\n    }\r\n\r\n    // /**\r\n    //  * @param {String} text \r\n    //  * @return {String}\r\n    //  */\r\n    // textProcessing(text) {\r\n    //     text = text.slice(0);\r\n\r\n    //     return text;\r\n    // }\r\n\r\n    // /**\r\n    //  * Get the text size like as RPG Maker VX Ace\r\n    //  * @param {String} text\r\n    //  */\r\n    // getTextSize(text) {\r\n    //     var font = this.contents._makeFontNameText();\r\n    //     var textDiv = document.createElement("div");\r\n        \r\n    //     textDiv.style.position = \'absolute\';\r\n    //     textDiv.style.float = \'left\';\r\n    //     textDiv.style.whiteSpace = \'nowrap\';\r\n    //     textDiv.style.visibility = \'hidden\';\r\n    //     textDiv.style.font = font;\r\n    //     textDiv.innerHTML = text;\r\n\r\n    //     document.body.appendChild(textDiv);\r\n\r\n    //     const rect = new PIXI.Rectangle(\r\n    //         0, \r\n    //         0, \r\n    //         textDiv.clientWidth,\r\n    //         textDiv.clientHeight,\r\n    //     );\r\n\r\n    //     document.body.removeChild(textDiv);\r\n\r\n    //     return rect;\r\n    // }    \r\n\r\n    // /**\r\n    //  * Create a texture.\r\n    //  * @param {MV.TextState} textState \r\n    //  */          \r\n    // createLocalTexture(textState) {\r\n \r\n    //     var temp = textState.text;\r\n    //     var lines = temp.split(/[\\r\\n]+/i);\r\n\r\n    //     var rect = this.getTextSize(temp);\r\n    //     var bitmap = new Bitmap(rect.width, rect.height * lines.length);\r\n        \r\n    //     this.contents.clear();\r\n\r\n    //     // lines.forEach((line,i,a) => {\r\n    //     //     bitmap.drawText(line, 0, i * rect.height, rect.width, rect.height, "left");\r\n    //     // });\r\n\r\n    //     this.drawTextEx(temp, 0, this.height + 6);\r\n\r\n    //     bitmap.blt(this.contents, 0, this.height + 6, bitmap.width, bitmap.height, 0, 0, this.bitmap.width, bitmap.height);\r\n\r\n    //     return bitmap;\r\n\r\n    // }\r\n\r\n    _updateContents() {\r\n        super._updateContents();\r\n\r\n        // if(this._mainTextLayer) {\r\n        //     var padding = this.textPadding();\r\n        //     this._mainTextLayer.x = this.x + padding;\r\n        //     this._mainTextLayer.y = this.y + padding;\r\n        // }\r\n    }\r\n\r\n    createMainTextLayer() {\r\n        var w = this._width - this._padding * 2;\r\n        var h = this._height - this._padding * 2;\r\n\r\n        this._mainTextLayer = new Sprite();\r\n        this._mainTextLayer.setFrame(this.origin.x, this.origin.y, w, h);\r\n        this._mainTextLayer.on("effect", this.startTextEffect, this);\r\n        this._windowContentsSprite.addChild(this._mainTextLayer);\r\n    }\r\n\r\n    terminateMainTextLayer() {\r\n        if(this._mainTextLayer) {\r\n            this._windowContentsSprite.removeChild(this._mainTextLayer);\r\n            this._mainTextLayer = null;\r\n        }\r\n    }\r\n\r\n    terminateMessage() {\r\n        super.terminateMessage();\r\n\r\n        if(this._mainTextLayer) {\r\n            this._mainTextLayer.removeChildren();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @param {Array} args\r\n     */\r\n    startTextEffect(args) {\r\n\r\n        /**\r\n         * @type {TextEffect}\r\n         */\r\n        const bitmap = args[0];  \r\n        const effectType = RS.MessageEffects.Params.currentEffect;\r\n        const textState = args[1];\r\n\r\n        if(!bitmap) return;                       \r\n\r\n        let sprite = EffectFactory.create(effectType);\r\n\r\n        sprite.bitmap = bitmap;\r\n             \r\n        this._mainTextLayer.addChild(sprite);       \r\n\r\n        sprite.start(textState);\r\n\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param {MV.TextState} textState \r\n     */\r\n    addText(textState) {\r\n        if(!this.contents) {\r\n            this.createContents();\r\n        }\r\n\r\n        let c = textState.text[textState.index++];\r\n        \r\n        let w = this.textWidth(c);\r\n        let h = textState.height;\r\n\r\n        var bitmap = new Bitmap(w * 2, h);\r\n\r\n        // FontFace를 먼저 설정해야 색깔이 정상적으로 변경됨\r\n        bitmap.fontFace = this.standardFontFace();\r\n\r\n        bitmap.fontSize = this.standardFontSize();\r\n        bitmap.fontItalic = this.contents.fontItalic;\r\n        bitmap.textColor = this.contents.textColor;\r\n        bitmap.outlineColor = this.contents.outlineColor;\r\n        bitmap.outlineWidth = this.contents.outlineWidth;\r\n\r\n        if(this.contents.width < Math.floor(textState.x + w * 2)) {\r\n            return;\r\n        }\r\n\r\n        // 자동 개행, 배경색 설정을 위해서.\r\n        if(Imported.RS_MessageSystem) {\r\n            bitmap.fontBold = this.contents.fontBold;\r\n\r\n            var width = this.contentsWidth();\r\n\r\n            var isValid = ($gameMessage.getBalloon() === -2) && !this._isUsedTextWidthEx && RS.MessageSystem.Params.isParagraphMinifier;\r\n        \r\n            this.processWordWrap(textState, w, width, isValid);\r\n        \r\n            if($gameMessage.faceName() !== "") {\r\n              width = this.contents.width - (Window_Base._faceWidth);\r\n              isValid = (RS.MessageSystem.Params.faceDirection === 2);\r\n              this.processWordWrap(textState, w, width, isValid);\r\n            }\r\n\r\n            if(this.contents.highlightTextColor != null) {\r\n                bitmap.fillRect( 0, 0, w + 1.0, textState.height, this.contents.highlightTextColor);\r\n            }\r\n            \r\n        }\r\n\r\n        bitmap.drawText(c, 0, 0, w * 2 , h, "left");\r\n\r\n        this._mainTextLayer.emit("effect", [\r\n            bitmap,\r\n            textState\r\n        ]);\r\n        \r\n        textState.x += w;\r\n\r\n        if(Imported.RS_MessageSystem) {\r\n            !this._showFast && this.startWait($gameMessage.getWaitTime() || 0);\r\n            if((textState.index % RS.MessageSystem.Params.textSoundInterval) === 0) this._requestTextSound();                \r\n        }\r\n    }\r\n\r\n    /**\r\n     * @method obtainTextEffectName\r\n     * @param {MV.TextState} textState \r\n     */\r\n    obtainTextEffectName(textState) {\r\n        var arr = /\\<(.*)\\>/.exec(textState.text.slice(textState.index));\r\n        if (arr) {\r\n            textState.index += arr[0].length;\r\n            return String(arr[1]);\r\n        } else {\r\n            return "";\r\n        }\r\n    }\r\n\r\n    setTextEffect(textEffect) {\r\n        if(typeof(textEffect) === "number") {\r\n            var keys = Object.keys(EffectFactory.TYPE);\r\n            var effects = keys[textEffect];\r\n            if(keys.contains(effects)) {\r\n                textEffect = effects;\r\n            } else {\r\n                textEffect = RS.MessageEffects.Params.defaultTextEffect;\r\n            }\r\n        }\r\n        RS.MessageEffects.Params.currentEffect = textEffect;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param {String} code \r\n     * @param {MV.TextState} textState \r\n     */\r\n    processEscapeCharacter(code, textState) {                          \r\n        switch (code) {\r\n            case \'텍스트효과\':\r\n            case \'TE\': // \\TE<PingPong>\r\n                const textEffectName = this.obtainTextEffectName(textState);\r\n                if(!this._isUsedTextWidthEx) {\r\n                    this.setTextEffect(textEffectName);\r\n                }\r\n                break;\r\n            case \'E\': // \\E[1]\r\n                const effectNum = this.obtainEscapeParam(textState);\r\n                if(!this._isUsedTextWidthEx) {                    \r\n                    this.setTextEffect(effectNum - 1);\r\n                }                \r\n            default:\r\n                super.processEscapeCharacter(code, textState);\r\n                break;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @param {MV.TextState} textState \r\n     */        \r\n    processNormalCharacter(textState) {\r\n        if(RS.MessageEffects.Params.currentEffect !== "none") {\r\n            this.addText(textState);\r\n        } else {\r\n            super.processNormalCharacter(textState);\r\n        }\r\n    }\r\n\r\n    startPause() {\r\n        super.startPause();\r\n        // this._mainTextLayer.children.forEach(i => i.flush());\r\n    }\r\n\r\n\r\n    // renderCanvas(renderer) {\r\n    //     if (!this.visible || !this.renderable) {\r\n    //         return;\r\n    //     }\r\n    \r\n    //     var layers = this.children;\r\n    //     for (var i = 0; i < layers.length; i++)\r\n    //         layers[i].renderCanvas(renderer);\r\n    \r\n    //     if(this._mainTextLayer && this._mainTextLayer.parent !== this) {\r\n    //       this._mainTextLayer.setParent(this);\r\n    //     }\r\n    \r\n    //     for (var i = 0; i <this._mainTextLayer.children.length; i++ ) {\r\n    //       var child = this._mainTextLayer.children[i];\r\n    //       if(child) renderer.plugins.sprite.render(child);\r\n    //     }\r\n        \r\n    // }\r\n\r\n    // /**\r\n    //  * \r\n    //  * @param {PIXI.WebGLRenderer} renderer \r\n    //  */\r\n    // renderWebGL(renderer) {\r\n\r\n    //     if(!this.visible || !this.renderable) {\r\n    //         return;\r\n    //     }     \r\n    \r\n    //     renderer.bindRenderTexture(this._renderTexture);\r\n\r\n    //     for(var i = 0; i < this.children.length; ++i) {\r\n    //         var child = this.children[i];\r\n    //         if(child.visible) renderer.render(child, this._renderTexture);\r\n    //     }\r\n    \r\n    //     if(this._mainTextLayer.visible) renderer.render(this._mainTextLayer, this._renderTexture);\r\n    \r\n    //     renderer.bindRenderTarget(this._renderTarget);\r\n\r\n    // }    \r\n\r\n\r\n}\r\n\r\nwindow.Window_Message = Window_MessageImpl;\r\n\r\nvar alias_Game_Interpreter_pluginCommand = Game_Interpreter.prototype.pluginCommand;\r\nGame_Interpreter.prototype.pluginCommand = function(command, args) {\r\n    alias_Game_Interpreter_pluginCommand.call(this, command, args);\r\n    if(command === "MessageEffectMap") {\r\n        RS.MessageEffects.Params.currentEffect = args[0];\r\n    }\r\n};                 //# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9saWIvUlNfTWVzc2FnZUVmZmVjdHMvY29yZS5qcz82YWQ5Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxrRUFBa0Usb0JBQW9CO0FBQ3RGLGdFQUFnRSxpQkFBaUI7QUFDakY7QUFDQTtBQUNBO0FBQ0EscUM7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxrQkFBa0IsT0FBTztBQUN6QixtQkFBbUI7QUFDbkI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGtCQUFrQixPQUFPO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxROztBQUVBO0FBQ0E7QUFDQSxrQkFBa0IsYUFBYTtBQUMvQjtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsZUFBZTs7QUFFZjs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGVBQWUsTUFBTTtBQUNyQjtBQUNBOztBQUVBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0EsK0I7QUFDQTtBQUNBOztBQUVBLDJCOztBQUVBOztBQUVBOztBQUVBLDZDOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxlQUFlLGFBQWE7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSw2RztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGVBQWUsYUFBYTtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxlQUFlLE9BQU87QUFDdEIsZUFBZSxhQUFhO0FBQzVCO0FBQ0EsNkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhDO0FBQ0E7QUFDQSxpQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxlQUFlLGFBQWE7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDBCQUEwQixtQkFBbUI7QUFDN0M7O0FBRUE7QUFDQTtBQUNBOztBQUVBLDBCQUEwQix3Q0FBd0M7QUFDbEU7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxrQkFBa0IsbUJBQW1CO0FBQ3JDO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFk7O0FBRUE7O0FBRUEseUJBQXlCLDBCQUEwQjtBQUNuRDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUEsUTs7O0FBR0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRSIsImZpbGUiOiIwLmpzIiwic291cmNlc0NvbnRlbnQiOlsid2luZG93LkltcG9ydGVkID0gd2luZG93LkltcG9ydGVkIHx8IHt9O1xyXG5JbXBvcnRlZC5SU19NZXNzYWdlRWZmZWN0cyA9IHRydWU7XHJcblxyXG53aW5kb3cuUlMgPSB3aW5kb3cuUlMgfHwge307XHJcbndpbmRvdy5SUy5NZXNzYWdlRWZmZWN0cyA9IHdpbmRvdy5SUy5NZXNzYWdlRWZmZWN0cyB8fCB7fTtcclxuXHJcbnZhciBwYXJhbWV0ZXJzID0gJHBsdWdpbnMuZmlsdGVyKGZ1bmN0aW9uIChpKSB7XHJcbiAgcmV0dXJuIGkuZGVzY3JpcHRpb24uY29udGFpbnMoJzxSU19NZXNzYWdlRWZmZWN0cz4nKTtcclxufSk7XHJcblxyXG5wYXJhbWV0ZXJzID0gKHBhcmFtZXRlcnMubGVuZ3RoID4gMCkgJiYgcGFyYW1ldGVyc1swXS5wYXJhbWV0ZXJzO1xyXG5cclxuUlMuTWVzc2FnZUVmZmVjdHMuUGFyYW1zID0ge307XHJcblxyXG5SUy5NZXNzYWdlRWZmZWN0cy5QYXJhbXMuZGVmYXVsdFRleHRFZmZlY3QgPSBwYXJhbWV0ZXJzW1wiRGVmYXVsdCBUZXh0IEVmZmVjdFwiXSB8fCBcIm5vbmVcIjtcclxuUlMuTWVzc2FnZUVmZmVjdHMuUGFyYW1zLmN1cnJlbnRFZmZlY3QgPSBSUy5NZXNzYWdlRWZmZWN0cy5QYXJhbXMuZGVmYXVsdFRleHRFZmZlY3Q7XHJcblJTLk1lc3NhZ2VFZmZlY3RzLlBhcmFtcy5jbGVhckZsYWcgPSBCb29sZWFuKHBhcmFtZXRlcnNbXCJDbGVhciBGbGFnXCJdID09PSBcInRydWVcIik7XHJcblxyXG4vLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8gV2luZG93X01lc3NhZ2VJbXBsXHJcbi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAgICBcclxuY2xhc3MgV2luZG93X01lc3NhZ2VJbXBsIGV4dGVuZHMgV2luZG93X01lc3NhZ2Uge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgc3VwZXIoKTtcclxuXHJcbiAgICAgICAgdGhpcy5jcmVhdGVNYWluVGV4dExheWVyKCk7XHJcbiAgICAgICAgLy8gdGhpcy5jcmVhdGVSZW5kZXJUZXh0dXJlKCk7XHJcblxyXG4gICAgICAgIHRoaXMub25jZShcInJlbW92ZWRcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnRlcm1pbmF0ZU1haW5UZXh0TGF5ZXIoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgLy8gY3JlYXRlUmVuZGVyVGV4dHVyZSgpIHtcclxuICAgIC8vICAgICBjb25zdCBnbCA9IEdyYXBoaWNzLl9yZW5kZXJlci5nbDtcclxuICAgIFxyXG4gICAgLy8gICAgIC8vIENyZWF0ZSBSZW5kZXJUZXh0dXJlXHJcbiAgICAvLyAgICAgdGhpcy5fcmVuZGVyVGV4dHVyZSA9IFBJWEkuUmVuZGVyVGV4dHVyZS5jcmVhdGUoXHJcbiAgICAvLyAgICAgICAgIHRoaXMud2lkdGgsXHJcbiAgICAvLyAgICAgICAgIHRoaXMuaGVpZ2h0LFxyXG4gICAgLy8gICAgICAgICBQSVhJLlNDQUxFX01PREVTLk5FQVJFU1RcclxuICAgIC8vICAgICApO1xyXG4gICAgXHJcbiAgICAvLyAgICAgLy8gQ3JlYXRlIFJlbmRlclRhcmdldFxyXG4gICAgLy8gICAgIGlmKEdyYXBoaWNzLmlzV2ViR0woKSkge1xyXG4gICAgLy8gICAgICAgICB0aGlzLl9yZW5kZXJUYXJnZXQgPSBuZXcgUElYSS5SZW5kZXJUYXJnZXQoXHJcbiAgICAvLyAgICAgICAgICAgICBnbCwgXHJcbiAgICAvLyAgICAgICAgICAgICB0aGlzLndpZHRoLFxyXG4gICAgLy8gICAgICAgICAgICAgdGhpcy5oZWlnaHQsXHJcbiAgICAvLyAgICAgICAgICAgICBQSVhJLlNDQUxFX01PREVTLk5FQVJFU1RcclxuICAgIC8vICAgICAgICAgKTtcclxuICAgIC8vICAgICB9IGVsc2Uge1xyXG4gICAgLy8gICAgICAgICB0aGlzLl9yZW5kZXJUYXJnZXQgPSBuZXcgUElYSS5DYW52YXNSZW5kZXJUYXJnZXQodGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xyXG4gICAgLy8gICAgIH1cclxuICAgIFxyXG4gICAgLy8gICAgIC8vIENyZWF0ZSBTcHJpdGVcclxuICAgIC8vICAgICB0aGlzLl9yZW5kZXJTcHJpdGUgPSBuZXcgU3ByaXRlKCk7XHJcblxyXG4gICAgLy8gICAgIHRoaXMub24oXCJyZW1vdmVkXCIsIHRoaXMuZGVzdHJveVJlbmRlclRleHR1cmUsIHRoaXMpO1xyXG5cclxuICAgIC8vICAgICB0aGlzLl9pbml0ID0gdHJ1ZTtcclxuXHJcbiAgICAvLyB9XHJcblxyXG4gICAgLy8gZGVzdHJveVJlbmRlclRleHR1cmUoKSB7XHJcbiAgICAvLyAgICAgaWYoIHRoaXMuX3JlbmRlclRleHR1cmUgKSB0aGlzLl9yZW5kZXJUZXh0dXJlLmRlc3Ryb3koeyBkZXN0cm95QmFzZTogdHJ1ZSB9KTtcclxuICAgIC8vICAgICBpZiggdGhpcy5fcmVuZGVyU3ByaXRlICkgdGhpcy5fcmVuZGVyU3ByaXRlLmRlc3Ryb3koeyBjaGlsZHJlbjogdHJ1ZSB9KTtcclxuICAgIC8vICAgICBpZiggdGhpcy5fcmVuZGVyVGFyZ2V0ICkgdGhpcy5fcmVuZGVyVGFyZ2V0LmRlc3Ryb3koKTtcclxuICAgIC8vICAgICB0aGlzLl9yZW5kZXJUZXh0dXJlID0gbnVsbDtcclxuICAgIC8vICAgICB0aGlzLl9yZW5kZXJTcHJpdGUgPSBudWxsO1xyXG4gICAgLy8gICAgIHRoaXMuX3JlbmRlclRhcmdldCA9IG51bGw7ICAgICBcclxuICAgIC8vIH1cclxuXHJcbiAgICBjbGVhckZsYWdzKCkge1xyXG4gICAgICAgIHN1cGVyLmNsZWFyRmxhZ3MoKTtcclxuICAgICAgICBpZihSUy5NZXNzYWdlRWZmZWN0cy5QYXJhbXMuY2xlYXJGbGFnKSB7XHJcbiAgICAgICAgICAgIFJTLk1lc3NhZ2VFZmZlY3RzLlBhcmFtcy5jdXJyZW50RWZmZWN0ID0gJ25vbmUnO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyAvKipcclxuICAgIC8vICAqIEBwYXJhbSB7U3RyaW5nfSB0ZXh0IFxyXG4gICAgLy8gICogQHJldHVybiB7U3RyaW5nfVxyXG4gICAgLy8gICovXHJcbiAgICAvLyB0ZXh0UHJvY2Vzc2luZyh0ZXh0KSB7XHJcbiAgICAvLyAgICAgdGV4dCA9IHRleHQuc2xpY2UoMCk7XHJcblxyXG4gICAgLy8gICAgIHJldHVybiB0ZXh0O1xyXG4gICAgLy8gfVxyXG5cclxuICAgIC8vIC8qKlxyXG4gICAgLy8gICogR2V0IHRoZSB0ZXh0IHNpemUgbGlrZSBhcyBSUEcgTWFrZXIgVlggQWNlXHJcbiAgICAvLyAgKiBAcGFyYW0ge1N0cmluZ30gdGV4dFxyXG4gICAgLy8gICovXHJcbiAgICAvLyBnZXRUZXh0U2l6ZSh0ZXh0KSB7XHJcbiAgICAvLyAgICAgdmFyIGZvbnQgPSB0aGlzLmNvbnRlbnRzLl9tYWtlRm9udE5hbWVUZXh0KCk7XHJcbiAgICAvLyAgICAgdmFyIHRleHREaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIFxyXG4gICAgLy8gICAgIHRleHREaXYuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xyXG4gICAgLy8gICAgIHRleHREaXYuc3R5bGUuZmxvYXQgPSAnbGVmdCc7XHJcbiAgICAvLyAgICAgdGV4dERpdi5zdHlsZS53aGl0ZVNwYWNlID0gJ25vd3JhcCc7XHJcbiAgICAvLyAgICAgdGV4dERpdi5zdHlsZS52aXNpYmlsaXR5ID0gJ2hpZGRlbic7XHJcbiAgICAvLyAgICAgdGV4dERpdi5zdHlsZS5mb250ID0gZm9udDtcclxuICAgIC8vICAgICB0ZXh0RGl2LmlubmVySFRNTCA9IHRleHQ7XHJcblxyXG4gICAgLy8gICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGV4dERpdik7XHJcblxyXG4gICAgLy8gICAgIGNvbnN0IHJlY3QgPSBuZXcgUElYSS5SZWN0YW5nbGUoXHJcbiAgICAvLyAgICAgICAgIDAsIFxyXG4gICAgLy8gICAgICAgICAwLCBcclxuICAgIC8vICAgICAgICAgdGV4dERpdi5jbGllbnRXaWR0aCxcclxuICAgIC8vICAgICAgICAgdGV4dERpdi5jbGllbnRIZWlnaHQsXHJcbiAgICAvLyAgICAgKTtcclxuXHJcbiAgICAvLyAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0ZXh0RGl2KTtcclxuXHJcbiAgICAvLyAgICAgcmV0dXJuIHJlY3Q7XHJcbiAgICAvLyB9ICAgIFxyXG5cclxuICAgIC8vIC8qKlxyXG4gICAgLy8gICogQ3JlYXRlIGEgdGV4dHVyZS5cclxuICAgIC8vICAqIEBwYXJhbSB7TVYuVGV4dFN0YXRlfSB0ZXh0U3RhdGUgXHJcbiAgICAvLyAgKi8gICAgICAgICAgXHJcbiAgICAvLyBjcmVhdGVMb2NhbFRleHR1cmUodGV4dFN0YXRlKSB7XHJcbiBcclxuICAgIC8vICAgICB2YXIgdGVtcCA9IHRleHRTdGF0ZS50ZXh0O1xyXG4gICAgLy8gICAgIHZhciBsaW5lcyA9IHRlbXAuc3BsaXQoL1tcXHJcXG5dKy9pKTtcclxuXHJcbiAgICAvLyAgICAgdmFyIHJlY3QgPSB0aGlzLmdldFRleHRTaXplKHRlbXApO1xyXG4gICAgLy8gICAgIHZhciBiaXRtYXAgPSBuZXcgQml0bWFwKHJlY3Qud2lkdGgsIHJlY3QuaGVpZ2h0ICogbGluZXMubGVuZ3RoKTtcclxuICAgICAgICBcclxuICAgIC8vICAgICB0aGlzLmNvbnRlbnRzLmNsZWFyKCk7XHJcblxyXG4gICAgLy8gICAgIC8vIGxpbmVzLmZvckVhY2goKGxpbmUsaSxhKSA9PiB7XHJcbiAgICAvLyAgICAgLy8gICAgIGJpdG1hcC5kcmF3VGV4dChsaW5lLCAwLCBpICogcmVjdC5oZWlnaHQsIHJlY3Qud2lkdGgsIHJlY3QuaGVpZ2h0LCBcImxlZnRcIik7XHJcbiAgICAvLyAgICAgLy8gfSk7XHJcblxyXG4gICAgLy8gICAgIHRoaXMuZHJhd1RleHRFeCh0ZW1wLCAwLCB0aGlzLmhlaWdodCArIDYpO1xyXG5cclxuICAgIC8vICAgICBiaXRtYXAuYmx0KHRoaXMuY29udGVudHMsIDAsIHRoaXMuaGVpZ2h0ICsgNiwgYml0bWFwLndpZHRoLCBiaXRtYXAuaGVpZ2h0LCAwLCAwLCB0aGlzLmJpdG1hcC53aWR0aCwgYml0bWFwLmhlaWdodCk7XHJcblxyXG4gICAgLy8gICAgIHJldHVybiBiaXRtYXA7XHJcblxyXG4gICAgLy8gfVxyXG5cclxuICAgIF91cGRhdGVDb250ZW50cygpIHtcclxuICAgICAgICBzdXBlci5fdXBkYXRlQ29udGVudHMoKTtcclxuXHJcbiAgICAgICAgLy8gaWYodGhpcy5fbWFpblRleHRMYXllcikge1xyXG4gICAgICAgIC8vICAgICB2YXIgcGFkZGluZyA9IHRoaXMudGV4dFBhZGRpbmcoKTtcclxuICAgICAgICAvLyAgICAgdGhpcy5fbWFpblRleHRMYXllci54ID0gdGhpcy54ICsgcGFkZGluZztcclxuICAgICAgICAvLyAgICAgdGhpcy5fbWFpblRleHRMYXllci55ID0gdGhpcy55ICsgcGFkZGluZztcclxuICAgICAgICAvLyB9XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlTWFpblRleHRMYXllcigpIHtcclxuICAgICAgICB2YXIgdyA9IHRoaXMuX3dpZHRoIC0gdGhpcy5fcGFkZGluZyAqIDI7XHJcbiAgICAgICAgdmFyIGggPSB0aGlzLl9oZWlnaHQgLSB0aGlzLl9wYWRkaW5nICogMjtcclxuXHJcbiAgICAgICAgdGhpcy5fbWFpblRleHRMYXllciA9IG5ldyBTcHJpdGUoKTtcclxuICAgICAgICB0aGlzLl9tYWluVGV4dExheWVyLnNldEZyYW1lKHRoaXMub3JpZ2luLngsIHRoaXMub3JpZ2luLnksIHcsIGgpO1xyXG4gICAgICAgIHRoaXMuX21haW5UZXh0TGF5ZXIub24oXCJlZmZlY3RcIiwgdGhpcy5zdGFydFRleHRFZmZlY3QsIHRoaXMpO1xyXG4gICAgICAgIHRoaXMuX3dpbmRvd0NvbnRlbnRzU3ByaXRlLmFkZENoaWxkKHRoaXMuX21haW5UZXh0TGF5ZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIHRlcm1pbmF0ZU1haW5UZXh0TGF5ZXIoKSB7XHJcbiAgICAgICAgaWYodGhpcy5fbWFpblRleHRMYXllcikge1xyXG4gICAgICAgICAgICB0aGlzLl93aW5kb3dDb250ZW50c1Nwcml0ZS5yZW1vdmVDaGlsZCh0aGlzLl9tYWluVGV4dExheWVyKTtcclxuICAgICAgICAgICAgdGhpcy5fbWFpblRleHRMYXllciA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHRlcm1pbmF0ZU1lc3NhZ2UoKSB7XHJcbiAgICAgICAgc3VwZXIudGVybWluYXRlTWVzc2FnZSgpO1xyXG5cclxuICAgICAgICBpZih0aGlzLl9tYWluVGV4dExheWVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX21haW5UZXh0TGF5ZXIucmVtb3ZlQ2hpbGRyZW4oKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcmdzXHJcbiAgICAgKi9cclxuICAgIHN0YXJ0VGV4dEVmZmVjdChhcmdzKSB7XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEB0eXBlIHtUZXh0RWZmZWN0fVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGNvbnN0IGJpdG1hcCA9IGFyZ3NbMF07ICBcclxuICAgICAgICBjb25zdCBlZmZlY3RUeXBlID0gUlMuTWVzc2FnZUVmZmVjdHMuUGFyYW1zLmN1cnJlbnRFZmZlY3Q7XHJcbiAgICAgICAgY29uc3QgdGV4dFN0YXRlID0gYXJnc1sxXTtcclxuXHJcbiAgICAgICAgaWYoIWJpdG1hcCkgcmV0dXJuOyAgICAgICAgICAgICAgICAgICAgICAgXHJcblxyXG4gICAgICAgIGxldCBzcHJpdGUgPSBFZmZlY3RGYWN0b3J5LmNyZWF0ZShlZmZlY3RUeXBlKTtcclxuXHJcbiAgICAgICAgc3ByaXRlLmJpdG1hcCA9IGJpdG1hcDtcclxuICAgICAgICAgICAgIFxyXG4gICAgICAgIHRoaXMuX21haW5UZXh0TGF5ZXIuYWRkQ2hpbGQoc3ByaXRlKTsgICAgICAgXHJcblxyXG4gICAgICAgIHNwcml0ZS5zdGFydCh0ZXh0U3RhdGUpO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFxyXG4gICAgICogQHBhcmFtIHtNVi5UZXh0U3RhdGV9IHRleHRTdGF0ZSBcclxuICAgICAqL1xyXG4gICAgYWRkVGV4dCh0ZXh0U3RhdGUpIHtcclxuICAgICAgICBpZighdGhpcy5jb250ZW50cykge1xyXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZUNvbnRlbnRzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgYyA9IHRleHRTdGF0ZS50ZXh0W3RleHRTdGF0ZS5pbmRleCsrXTtcclxuICAgICAgICBcclxuICAgICAgICBsZXQgdyA9IHRoaXMudGV4dFdpZHRoKGMpO1xyXG4gICAgICAgIGxldCBoID0gdGV4dFN0YXRlLmhlaWdodDtcclxuXHJcbiAgICAgICAgdmFyIGJpdG1hcCA9IG5ldyBCaXRtYXAodyAqIDIsIGgpO1xyXG5cclxuICAgICAgICAvLyBGb250RmFjZeulvCDrqLzsoIAg7ISk7KCV7ZW07JW8IOyDieq5lOydtCDsoJXsg4HsoIHsnLzroZwg67OA6rK965CoXHJcbiAgICAgICAgYml0bWFwLmZvbnRGYWNlID0gdGhpcy5zdGFuZGFyZEZvbnRGYWNlKCk7XHJcblxyXG4gICAgICAgIGJpdG1hcC5mb250U2l6ZSA9IHRoaXMuc3RhbmRhcmRGb250U2l6ZSgpO1xyXG4gICAgICAgIGJpdG1hcC5mb250SXRhbGljID0gdGhpcy5jb250ZW50cy5mb250SXRhbGljO1xyXG4gICAgICAgIGJpdG1hcC50ZXh0Q29sb3IgPSB0aGlzLmNvbnRlbnRzLnRleHRDb2xvcjtcclxuICAgICAgICBiaXRtYXAub3V0bGluZUNvbG9yID0gdGhpcy5jb250ZW50cy5vdXRsaW5lQ29sb3I7XHJcbiAgICAgICAgYml0bWFwLm91dGxpbmVXaWR0aCA9IHRoaXMuY29udGVudHMub3V0bGluZVdpZHRoO1xyXG5cclxuICAgICAgICBpZih0aGlzLmNvbnRlbnRzLndpZHRoIDwgTWF0aC5mbG9vcih0ZXh0U3RhdGUueCArIHcgKiAyKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDsnpDrj5kg6rCc7ZaJLCDrsLDqsr3sg4kg7ISk7KCV7J2EIOychO2VtOyEnC5cclxuICAgICAgICBpZihJbXBvcnRlZC5SU19NZXNzYWdlU3lzdGVtKSB7XHJcbiAgICAgICAgICAgIGJpdG1hcC5mb250Qm9sZCA9IHRoaXMuY29udGVudHMuZm9udEJvbGQ7XHJcblxyXG4gICAgICAgICAgICB2YXIgd2lkdGggPSB0aGlzLmNvbnRlbnRzV2lkdGgoKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBpc1ZhbGlkID0gKCRnYW1lTWVzc2FnZS5nZXRCYWxsb29uKCkgPT09IC0yKSAmJiAhdGhpcy5faXNVc2VkVGV4dFdpZHRoRXggJiYgUlMuTWVzc2FnZVN5c3RlbS5QYXJhbXMuaXNQYXJhZ3JhcGhNaW5pZmllcjtcclxuICAgICAgICBcclxuICAgICAgICAgICAgdGhpcy5wcm9jZXNzV29yZFdyYXAodGV4dFN0YXRlLCB3LCB3aWR0aCwgaXNWYWxpZCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgICAgIGlmKCRnYW1lTWVzc2FnZS5mYWNlTmFtZSgpICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgd2lkdGggPSB0aGlzLmNvbnRlbnRzLndpZHRoIC0gKFdpbmRvd19CYXNlLl9mYWNlV2lkdGgpO1xyXG4gICAgICAgICAgICAgIGlzVmFsaWQgPSAoUlMuTWVzc2FnZVN5c3RlbS5QYXJhbXMuZmFjZURpcmVjdGlvbiA9PT0gMik7XHJcbiAgICAgICAgICAgICAgdGhpcy5wcm9jZXNzV29yZFdyYXAodGV4dFN0YXRlLCB3LCB3aWR0aCwgaXNWYWxpZCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmKHRoaXMuY29udGVudHMuaGlnaGxpZ2h0VGV4dENvbG9yICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGJpdG1hcC5maWxsUmVjdCggMCwgMCwgdyArIDEuMCwgdGV4dFN0YXRlLmhlaWdodCwgdGhpcy5jb250ZW50cy5oaWdobGlnaHRUZXh0Q29sb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgYml0bWFwLmRyYXdUZXh0KGMsIDAsIDAsIHcgKiAyICwgaCwgXCJsZWZ0XCIpO1xyXG5cclxuICAgICAgICB0aGlzLl9tYWluVGV4dExheWVyLmVtaXQoXCJlZmZlY3RcIiwgW1xyXG4gICAgICAgICAgICBiaXRtYXAsXHJcbiAgICAgICAgICAgIHRleHRTdGF0ZVxyXG4gICAgICAgIF0pO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHRleHRTdGF0ZS54ICs9IHc7XHJcblxyXG4gICAgICAgIGlmKEltcG9ydGVkLlJTX01lc3NhZ2VTeXN0ZW0pIHtcclxuICAgICAgICAgICAgIXRoaXMuX3Nob3dGYXN0ICYmIHRoaXMuc3RhcnRXYWl0KCRnYW1lTWVzc2FnZS5nZXRXYWl0VGltZSgpIHx8IDApO1xyXG4gICAgICAgICAgICBpZigodGV4dFN0YXRlLmluZGV4ICUgUlMuTWVzc2FnZVN5c3RlbS5QYXJhbXMudGV4dFNvdW5kSW50ZXJ2YWwpID09PSAwKSB0aGlzLl9yZXF1ZXN0VGV4dFNvdW5kKCk7ICAgICAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBtZXRob2Qgb2J0YWluVGV4dEVmZmVjdE5hbWVcclxuICAgICAqIEBwYXJhbSB7TVYuVGV4dFN0YXRlfSB0ZXh0U3RhdGUgXHJcbiAgICAgKi9cclxuICAgIG9idGFpblRleHRFZmZlY3ROYW1lKHRleHRTdGF0ZSkge1xyXG4gICAgICAgIHZhciBhcnIgPSAvXFw8KC4qKVxcPi8uZXhlYyh0ZXh0U3RhdGUudGV4dC5zbGljZSh0ZXh0U3RhdGUuaW5kZXgpKTtcclxuICAgICAgICBpZiAoYXJyKSB7XHJcbiAgICAgICAgICAgIHRleHRTdGF0ZS5pbmRleCArPSBhcnJbMF0ubGVuZ3RoO1xyXG4gICAgICAgICAgICByZXR1cm4gU3RyaW5nKGFyclsxXSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIFwiXCI7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNldFRleHRFZmZlY3QodGV4dEVmZmVjdCkge1xyXG4gICAgICAgIGlmKHR5cGVvZih0ZXh0RWZmZWN0KSA9PT0gXCJudW1iZXJcIikge1xyXG4gICAgICAgICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKEVmZmVjdEZhY3RvcnkuVFlQRSk7XHJcbiAgICAgICAgICAgIHZhciBlZmZlY3RzID0ga2V5c1t0ZXh0RWZmZWN0XTtcclxuICAgICAgICAgICAgaWYoa2V5cy5jb250YWlucyhlZmZlY3RzKSkge1xyXG4gICAgICAgICAgICAgICAgdGV4dEVmZmVjdCA9IGVmZmVjdHM7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0ZXh0RWZmZWN0ID0gUlMuTWVzc2FnZUVmZmVjdHMuUGFyYW1zLmRlZmF1bHRUZXh0RWZmZWN0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFJTLk1lc3NhZ2VFZmZlY3RzLlBhcmFtcy5jdXJyZW50RWZmZWN0ID0gdGV4dEVmZmVjdDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFxyXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGNvZGUgXHJcbiAgICAgKiBAcGFyYW0ge01WLlRleHRTdGF0ZX0gdGV4dFN0YXRlIFxyXG4gICAgICovXHJcbiAgICBwcm9jZXNzRXNjYXBlQ2hhcmFjdGVyKGNvZGUsIHRleHRTdGF0ZSkgeyAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgc3dpdGNoIChjb2RlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgJ+2FjeyKpO2KuO2aqOqzvCc6XHJcbiAgICAgICAgICAgIGNhc2UgJ1RFJzogLy8gXFxURTxQaW5nUG9uZz5cclxuICAgICAgICAgICAgICAgIGNvbnN0IHRleHRFZmZlY3ROYW1lID0gdGhpcy5vYnRhaW5UZXh0RWZmZWN0TmFtZSh0ZXh0U3RhdGUpO1xyXG4gICAgICAgICAgICAgICAgaWYoIXRoaXMuX2lzVXNlZFRleHRXaWR0aEV4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRUZXh0RWZmZWN0KHRleHRFZmZlY3ROYW1lKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdFJzogLy8gXFxFWzFdXHJcbiAgICAgICAgICAgICAgICBjb25zdCBlZmZlY3ROdW0gPSB0aGlzLm9idGFpbkVzY2FwZVBhcmFtKHRleHRTdGF0ZSk7XHJcbiAgICAgICAgICAgICAgICBpZighdGhpcy5faXNVc2VkVGV4dFdpZHRoRXgpIHsgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0VGV4dEVmZmVjdChlZmZlY3ROdW0gLSAxKTtcclxuICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICBzdXBlci5wcm9jZXNzRXNjYXBlQ2hhcmFjdGVyKGNvZGUsIHRleHRTdGF0ZSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAcGFyYW0ge01WLlRleHRTdGF0ZX0gdGV4dFN0YXRlIFxyXG4gICAgICovICAgICAgICBcclxuICAgIHByb2Nlc3NOb3JtYWxDaGFyYWN0ZXIodGV4dFN0YXRlKSB7XHJcbiAgICAgICAgaWYoUlMuTWVzc2FnZUVmZmVjdHMuUGFyYW1zLmN1cnJlbnRFZmZlY3QgIT09IFwibm9uZVwiKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYWRkVGV4dCh0ZXh0U3RhdGUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHN1cGVyLnByb2Nlc3NOb3JtYWxDaGFyYWN0ZXIodGV4dFN0YXRlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc3RhcnRQYXVzZSgpIHtcclxuICAgICAgICBzdXBlci5zdGFydFBhdXNlKCk7XHJcbiAgICAgICAgLy8gdGhpcy5fbWFpblRleHRMYXllci5jaGlsZHJlbi5mb3JFYWNoKGkgPT4gaS5mbHVzaCgpKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgLy8gcmVuZGVyQ2FudmFzKHJlbmRlcmVyKSB7XHJcbiAgICAvLyAgICAgaWYgKCF0aGlzLnZpc2libGUgfHwgIXRoaXMucmVuZGVyYWJsZSkge1xyXG4gICAgLy8gICAgICAgICByZXR1cm47XHJcbiAgICAvLyAgICAgfVxyXG4gICAgXHJcbiAgICAvLyAgICAgdmFyIGxheWVycyA9IHRoaXMuY2hpbGRyZW47XHJcbiAgICAvLyAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsYXllcnMubGVuZ3RoOyBpKyspXHJcbiAgICAvLyAgICAgICAgIGxheWVyc1tpXS5yZW5kZXJDYW52YXMocmVuZGVyZXIpO1xyXG4gICAgXHJcbiAgICAvLyAgICAgaWYodGhpcy5fbWFpblRleHRMYXllciAmJiB0aGlzLl9tYWluVGV4dExheWVyLnBhcmVudCAhPT0gdGhpcykge1xyXG4gICAgLy8gICAgICAgdGhpcy5fbWFpblRleHRMYXllci5zZXRQYXJlbnQodGhpcyk7XHJcbiAgICAvLyAgICAgfVxyXG4gICAgXHJcbiAgICAvLyAgICAgZm9yICh2YXIgaSA9IDA7IGkgPHRoaXMuX21haW5UZXh0TGF5ZXIuY2hpbGRyZW4ubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAvLyAgICAgICB2YXIgY2hpbGQgPSB0aGlzLl9tYWluVGV4dExheWVyLmNoaWxkcmVuW2ldO1xyXG4gICAgLy8gICAgICAgaWYoY2hpbGQpIHJlbmRlcmVyLnBsdWdpbnMuc3ByaXRlLnJlbmRlcihjaGlsZCk7XHJcbiAgICAvLyAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgLy8gfVxyXG5cclxuICAgIC8vIC8qKlxyXG4gICAgLy8gICogXHJcbiAgICAvLyAgKiBAcGFyYW0ge1BJWEkuV2ViR0xSZW5kZXJlcn0gcmVuZGVyZXIgXHJcbiAgICAvLyAgKi9cclxuICAgIC8vIHJlbmRlcldlYkdMKHJlbmRlcmVyKSB7XHJcblxyXG4gICAgLy8gICAgIGlmKCF0aGlzLnZpc2libGUgfHwgIXRoaXMucmVuZGVyYWJsZSkge1xyXG4gICAgLy8gICAgICAgICByZXR1cm47XHJcbiAgICAvLyAgICAgfSAgICAgXHJcbiAgICBcclxuICAgIC8vICAgICByZW5kZXJlci5iaW5kUmVuZGVyVGV4dHVyZSh0aGlzLl9yZW5kZXJUZXh0dXJlKTtcclxuXHJcbiAgICAvLyAgICAgZm9yKHZhciBpID0gMDsgaSA8IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyArK2kpIHtcclxuICAgIC8vICAgICAgICAgdmFyIGNoaWxkID0gdGhpcy5jaGlsZHJlbltpXTtcclxuICAgIC8vICAgICAgICAgaWYoY2hpbGQudmlzaWJsZSkgcmVuZGVyZXIucmVuZGVyKGNoaWxkLCB0aGlzLl9yZW5kZXJUZXh0dXJlKTtcclxuICAgIC8vICAgICB9XHJcbiAgICBcclxuICAgIC8vICAgICBpZih0aGlzLl9tYWluVGV4dExheWVyLnZpc2libGUpIHJlbmRlcmVyLnJlbmRlcih0aGlzLl9tYWluVGV4dExheWVyLCB0aGlzLl9yZW5kZXJUZXh0dXJlKTtcclxuICAgIFxyXG4gICAgLy8gICAgIHJlbmRlcmVyLmJpbmRSZW5kZXJUYXJnZXQodGhpcy5fcmVuZGVyVGFyZ2V0KTtcclxuXHJcbiAgICAvLyB9ICAgIFxyXG5cclxuXHJcbn1cclxuXHJcbndpbmRvdy5XaW5kb3dfTWVzc2FnZSA9IFdpbmRvd19NZXNzYWdlSW1wbDtcclxuXHJcbnZhciBhbGlhc19HYW1lX0ludGVycHJldGVyX3BsdWdpbkNvbW1hbmQgPSBHYW1lX0ludGVycHJldGVyLnByb3RvdHlwZS5wbHVnaW5Db21tYW5kO1xyXG5HYW1lX0ludGVycHJldGVyLnByb3RvdHlwZS5wbHVnaW5Db21tYW5kID0gZnVuY3Rpb24oY29tbWFuZCwgYXJncykge1xyXG4gICAgYWxpYXNfR2FtZV9JbnRlcnByZXRlcl9wbHVnaW5Db21tYW5kLmNhbGwodGhpcywgY29tbWFuZCwgYXJncyk7XHJcbiAgICBpZihjb21tYW5kID09PSBcIk1lc3NhZ2VFZmZlY3RNYXBcIikge1xyXG4gICAgICAgIFJTLk1lc3NhZ2VFZmZlY3RzLlBhcmFtcy5jdXJyZW50RWZmZWN0ID0gYXJnc1swXTtcclxuICAgIH1cclxufTsgICAgICAgICAgICAgICAgICJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///0\n')},function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n\n// EXTERNAL MODULE: ./lib/RS_MessageEffects/core.js\nvar core = __webpack_require__(0);\n\n// CONCATENATED MODULE: ./lib/RS_MessageEffects/TextEffect.js\n//================================================================\r\n// TextEffect\r\n//================================================================\r\nclass TextEffect extends Sprite {\r\n    constructor(bitmap) {\r\n        super(bitmap);\r\n        this._isStarted = false;\r\n        this._effectType = "pingpong";\r\n\r\n        if(Graphics.isWebGL()) {\r\n            this.filters = [Sprite.voidFilter];\r\n        }        \r\n    }\r\n\r\n    update() {\r\n        super.update();\r\n        this.updateEffects();\r\n    }\r\n\r\n    /**\r\n     * 종료\r\n     */\r\n    flush() {\r\n        this._isStarted = false;\r\n        this.x = this._startX;\r\n        this.y = this._startY;\r\n        this.rotation = this._desc.rotation;\r\n        this.scale.x = this._desc.scaleX;\r\n        this.scale.y = this._desc.scaleY;\r\n        this.skew.x = this._desc.skewX;\r\n        this.skew.y = this._desc.skewY;\r\n        this.tint = this._desc.tint;\r\n        this.filters = this._desc.filters;\r\n        this.opacity = this._tempOpacity;\r\n        this._desc = {};\r\n    }\r\n\r\n    updateEffects() {\r\n    }\r\n\r\n    /**\r\n     * 시작\r\n     * @param {MV.TextState} textState\r\n     */\r\n    start(textState) {\r\n        this._now = performance.now();\r\n        this._isStarted = true;       \r\n        this._power = 1;   \r\n        this.x = textState.x;\r\n        this.y = textState.y;\r\n        this._startX = this.x;\r\n        this._startY = this.y;\r\n        this._random = Math.floor(Math.random() * 60);\r\n        this._index = textState.index;\r\n        this._tempOpacity = this.opacity;\r\n\r\n        this._desc = {\r\n            x: this.x,\r\n            y: this.y,\r\n            rotation: this.rotation,    \r\n            scaleX: this.scale.x || 1.0,\r\n            scaleY: this.scale.y || 1.0,\r\n            skewX :this.skew.x || 0.0,\r\n            skewY :this.skew.y || 0.0,\r\n            opacity: this.opacity,\r\n            tint: this.tint,\r\n            filters: this.filters,\r\n        };\r\n        \r\n\r\n    };\r\n}\r\n\r\nclass EffectFactory {\r\n    static create(effectType) {\r\n        \r\n        let sprite;\r\n\r\n        var keys = Object.keys(EffectFactory.TYPE);\r\n\r\n        if(keys.contains(effectType)) {\r\n            var ET_CLASS = EffectFactory.TYPE[effectType];\r\n            sprite = new ET_CLASS();\r\n        } else {\r\n            sprite = new TextEffect();\r\n        }\r\n\r\n        return sprite;\r\n\r\n    }\r\n\r\n    static add(values) {\r\n        Object.assign( EffectFactory.TYPE, values );\r\n    }\r\n\r\n}\r\n\r\nif(!EffectFactory.TYPE) {\r\n\r\n    EffectFactory.TYPE = {\r\n    };\r\n\r\n    window.EffectFactory = EffectFactory;\r\n\r\n}\r\n\r\n\n// CONCATENATED MODULE: ./lib/RS_MessageEffects/EffectsPack1.js\n\r\n\r\nconst DEG_TO_RAD  = (Math.PI / 180.0);\r\n\r\nclass EffectsPack1_PingPong extends TextEffect {\r\n    \r\n  constructor(bitmap) {\r\n      super(bitmap);\r\n      this._effectType = "pingpong";\r\n  }\r\n\r\n  updateEffects() {\r\n      if(!this._isStarted) return;            \r\n      if(this._power <= 60) {\r\n          this.y = this._startY + (PIXI.PI_2 / this._power) * 4.0;\r\n          this._power++;\r\n      } else {\r\n          this.flush();\r\n      }\r\n  }\r\n}    \r\n\r\nclass EffectsPack1_Slide extends TextEffect {\r\n  \r\n  constructor(bitmap) {\r\n    super(bitmap);\r\n    this._effectType = "slide";\r\n  }\r\n  \r\n  updateEffects() {\r\n    if(!this._isStarted) return;            \r\n    if(this._power <= 60) {\r\n      this.x = this._startX + (PIXI.PI_2 / this._power) * (this._index % 4) * 4;\r\n      this.opacity = 4 * this._power;\r\n      this._power++;\r\n    } else {\r\n      this.flush();\r\n    }\r\n  }\r\n}        \r\n\r\nclass EffectsPack1_HighRotation extends TextEffect {\r\n  \r\n  constructor(bitmap) {\r\n    super(bitmap);\r\n    this._effectType = "high_rot";\r\n  }\r\n  \r\n  updateEffects() {\r\n    if(!this._isStarted) return;            \r\n    if(this._power <= this._random) {\r\n      let dist = this._random - this._power;\r\n      let tm = performance.now();\r\n      let r = DEG_TO_RAD * dist * (this._random % 2 == 0 ? -tm : tm);\r\n      let c = Math.cos(r);\r\n      let s = Math.sin(r);\r\n      let tx = this._startX - dist;\r\n      let ty = this._startY - dist;\r\n      this.x = tx * c - ty * s;\r\n      this.y = tx * s + ty * c;\r\n      this._power++;\r\n    } else {\r\n      this.flush();\r\n    }\r\n  }\r\n}            \r\n\r\nclass EffectsPack1_NormalRotation extends TextEffect {\r\n  \r\n  constructor(bitmap) {\r\n    super(bitmap);\r\n    this._effectType = "normal_rot";\r\n  }\r\n  \r\n  updateEffects() {\r\n    if(!this._isStarted) return;            \r\n    if(this._power <= this._random) {\r\n      let dist = this._random - this._power;\r\n      let tm = performance.now();\r\n      let r = DEG_TO_RAD * dist * (this._index % 3 == 0 ? -1 : 1);\r\n      let c = Math.cos(r);\r\n      let s = Math.sin(r);\r\n      let tx = (this._startX - dist);\r\n      let ty = this._startY - dist;\r\n      this.x = tx * c - ty * s;\r\n      this.y = tx * s + ty * c;\r\n      this._power++;\r\n    } else {\r\n      this.flush();\r\n    }\r\n  }\r\n}       \r\n\r\nclass EffectsPack1_RandomRotation extends TextEffect {\r\n  \r\n  constructor(bitmap) {\r\n    super(bitmap);\r\n    this._effectType = "random_rot";\r\n  }\r\n  \r\n  updateEffects() {\r\n    if(!this._isStarted) return;            \r\n    if(this._power <= this._random) {\r\n      let dist = this._random - this._power;\r\n      let r = DEG_TO_RAD * dist * (this._random % 2 == 0 ? -1 : 1);\r\n      let c = Math.cos(r);\r\n      let s = Math.sin(r);\r\n      let tx = this._startX - dist;\r\n      let ty = this._startY - dist;\r\n      this.x = tx * c - ty * s;\r\n      this.y = tx * s + ty * c;\r\n      this._power++;\r\n    } else {\r\n      this.flush();\r\n    }\r\n  }\r\n}         \r\n\r\nclass EffectsPack1_Shock extends TextEffect {\r\n  constructor(bitmap) {\r\n    super(bitmap);\r\n    \r\n    this._effectType = "shock";\r\n  }\r\n  \r\n  flush() {\r\n    super.flush();\r\n    this.rotation = 0.0;\r\n    this.anchor.x = 0.0;\r\n    this.anchor.y = 0.0;\r\n  }\r\n  \r\n  updateEffects() {\r\n    if(!this._isStarted) return;      \r\n    if(this._power <= 60) {\r\n      this.anchor.x = -0.8 + Math.random();\r\n      this.anchor.y = -0.8 + Math.random();                \r\n    } else {\r\n      this.flush();\r\n    }\r\n  }\r\n  \r\n  start(textState) {\r\n    super.start(textState);\r\n  }\r\n  \r\n}    \r\n\r\nEffectFactory.add({\r\n  \'pingpong\': EffectsPack1_PingPong,  \r\n  \'slide\': EffectsPack1_Slide,\r\n  \'high_rot\': EffectsPack1_HighRotation,\r\n  \'normal_rot\': EffectsPack1_NormalRotation,\r\n  \'random_rot\': EffectsPack1_RandomRotation,\r\n  \'shock\': EffectsPack1_Shock,    \r\n});\n// CONCATENATED MODULE: ./lib/RS_MessageEffects/EffectsPack2.js\n\r\n\r\nclass EffectsPack2_ZoomOut extends TextEffect {\r\n    \r\n    constructor(bitmap) {\r\n        super(bitmap);\r\n        \r\n        this._effectType = "zoomout";\r\n    }    \r\n\r\n    updateEffects() {\r\n        if(!this._isStarted) return;\r\n        this.scale.x = (200.0 - this._power) / 100.0;\r\n        this.scale.y = (200.0 - this._power) / 100.0;\r\n        \r\n        if((this.scale.x + 0.0001) <= 1.0) {\r\n            this.flush();\r\n        }\r\n\r\n        this._power++;\r\n    }   \r\n    \r\n    start(textState) {\r\n        super.start(textState);\r\n        this.scale.x = 1.5;\r\n        this.scale.y = 1.5;\r\n    }    \r\n}\r\n\r\nclass EffectsPack2_Marquee extends TextEffect {\r\n    constructor(bitmap) {\r\n        super(bitmap);\r\n        \r\n        this._effectType = "marquee";\r\n    }    \r\n\r\n    updateEffects() {\r\n        if(!this._isStarted) return;\r\n\r\n        this._ox -= 4;\r\n\r\n        this.x = this._startX + this._ox;\r\n\r\n        if(this._ox < 0) {\r\n            this.flush();\r\n        }\r\n    }   \r\n    \r\n    /**\r\n     * \r\n     * @param {MV.TextState} textState \r\n     */\r\n    start(textState) {\r\n        super.start(textState);\r\n\r\n        let width = 0;\r\n        let scene = SceneManager._scene;\r\n        if(scene && scene._messageWindow) {\r\n            width = scene._messageWindow.width;\r\n        } else {\r\n            width = Math.floor(Graphics.boxWidth / 2);\r\n        }\r\n            \r\n        this._ox = width;\r\n        this.x += width;\r\n\r\n    }    \r\n}\r\n\r\nclass EffectsPack2_Wave extends TextEffect {\r\n    constructor(bitmap) {\r\n        super(bitmap);\r\n        \r\n        this._effectType = "wave";\r\n    }    \r\n\r\n    updateEffects() {\r\n        if(!this._isStarted) return;\r\n        this.skew.x = 60.0 * Math.max(this._startX % 5, 1);\r\n        this.skew.y = Math.random() * 2.0 * this._index;\r\n        if(this._power >= 60) {\r\n            this.flush();\r\n        }\r\n        this._power++;\r\n    }   \r\n    \r\n    start(textState) {\r\n        super.start(textState);\r\n    }    \r\n}\r\n\r\nclass EffectsPack2_Spread extends TextEffect {\r\n    constructor(bitmap) {\r\n        super(bitmap);\r\n        \r\n        this._effectType = "spread";\r\n    }    \r\n\r\n    updateEffects() {\r\n        if(!this._isStarted) return;\r\n        if(!(performance.now() - this._lazy) >= 1500) return;\r\n        switch(this._index) {\r\n            case 3:\r\n                this.x = this._startX - this._power;\r\n                break;\r\n            case 1:\r\n                this.x = this._startX + this._power;\r\n                break;\r\n            case 0:\r\n                this.y = this._startY - this._power;\r\n                break;\r\n            case 2:\r\n                this.y = this._startY + this._power;\r\n                break;\r\n        }\r\n\r\n        if(this._power >= 600) {\r\n            this.flush();\r\n        }\r\n\r\n    }   \r\n    \r\n    /**\r\n     * \r\n     * @param {MV.TextState} textState \r\n     */\r\n    start(textState) {\r\n        super.start(textState);\r\n        this._lazy = performance.now();\r\n        this._index = textState.index % 4;\r\n    }    \r\n}\r\n\r\nclass EffectsPack2_MouseTracking extends TextEffect {\r\n    constructor(bitmap) {\r\n        super(bitmap);\r\n        \r\n        this._effectType = "mouse_tracking";\r\n    }\r\n\r\n    getDistance(x1, y1, x2, y2) {\r\n        return Math.sqrt( Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2) );\r\n    }\r\n\r\n    updateEffects() {\r\n        if(!this._isStarted) return;\r\n\r\n        let moveSpeed = this._dist / 30.0;\r\n\r\n        let x1 = this._startX - this.x;\r\n        let y1 = this._startY - this.y;\r\n        let xDist = 0;\r\n        let yDist = 0;\r\n\r\n        if(x1 < 0) {\r\n            xDist = moveSpeed;\r\n        } else if(x1 > 0) {\r\n            xDist = -moveSpeed;\r\n        } else {\r\n            xDist = 0;\r\n        }\r\n\r\n        if(y1 < 0) {\r\n            yDist = moveSpeed;\r\n        } else if(y1 > 0) {\r\n            yDist = -moveSpeed;\r\n        } else {\r\n            yDist = 0;\r\n        }\r\n\r\n        let tx = this.x - xDist;\r\n        let ty = this.y - yDist;\r\n\r\n        this.x = tx;\r\n        this.y = ty;\r\n\r\n        let dist = Math.floor(this.getDistance(this._startX, this._startY, TouchInput.x, TouchInput.y));\r\n        if(dist < 16) {\r\n            this.flush();\r\n        }\r\n\r\n    }   \r\n    \r\n    start(textState) {\r\n        super.start(textState);\r\n        this.x = TouchInput.x;\r\n        this.y = TouchInput.y;\r\n        this._dist = Math.floor(this.getDistance(this._startX, this._startY, TouchInput.x, TouchInput.y));\r\n    }\r\n}\r\n\r\nEffectFactory.add({\r\n    "zoomout": EffectsPack2_ZoomOut,\r\n    "marquee": EffectsPack2_Marquee,\r\n    "wave": EffectsPack2_Wave,\r\n    "zoomout": EffectsPack2_ZoomOut,\r\n    "spread": EffectsPack2_Spread,\r\n    "mouse_tracking": EffectsPack2_MouseTracking,\r\n});\n// CONCATENATED MODULE: ./lib/RS_MessageEffects/index.js\n\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9saWIvUlNfTWVzc2FnZUVmZmVjdHMvVGV4dEVmZmVjdC5qcz8yNjBiIiwid2VicGFjazovLy8uL2xpYi9SU19NZXNzYWdlRWZmZWN0cy9FZmZlY3RzUGFjazEuanM/NzBmNCIsIndlYnBhY2s6Ly8vLi9saWIvUlNfTWVzc2FnZUVmZmVjdHMvRWZmZWN0c1BhY2syLmpzP2I1MDIiLCJ3ZWJwYWNrOi8vLy4vbGliL1JTX01lc3NhZ2VFZmZlY3RzL2luZGV4LmpzPzYzYzMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsUztBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsZUFBZSxhQUFhO0FBQzVCO0FBQ0E7QUFDQTtBQUNBLCtCO0FBQ0Esd0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7OztBQ3hHdUQ7O0FBRXZEOztBQUVBLE1BQU0scUJBQVEsU0FBUyxVQUFVOztBQUVqQztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGtDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLEM7O0FBRUEsTUFBTSxrQkFBSyxTQUFTLFVBQVU7O0FBRTlCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsZ0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxDOztBQUVBLE1BQU0seUJBQVksU0FBUyxVQUFVOztBQUVyQztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxDOztBQUVBLE1BQU0sMkJBQWMsU0FBUyxVQUFVOztBQUV2QztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxDOztBQUVBLE1BQU0sMkJBQWMsU0FBUyxVQUFVOztBQUV2QztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsQzs7QUFFQSxNQUFNLGtCQUFLLFNBQVMsVUFBVTtBQUM5QjtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsZ0M7QUFDQTtBQUNBO0FBQ0EsMkM7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQSxDOztBQUVBLGFBQWE7QUFDYixjQUFjLHFCQUFRO0FBQ3RCLFdBQVcsa0JBQUs7QUFDaEIsY0FBYyx5QkFBWTtBQUMxQixnQkFBZ0IsMkJBQWM7QUFDOUIsZ0JBQWdCLDJCQUFjO0FBQzlCLFdBQVcsa0JBQUs7QUFDaEIsQ0FBQyxFOztBQzNKc0Q7O0FBRXZELE1BQU0sb0JBQU8sU0FBUyxVQUFVOztBQUVoQztBQUNBOztBQUVBO0FBQ0EsSzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxLOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSztBQUNBOztBQUVBLE1BQU0sb0JBQU8sU0FBUyxVQUFVO0FBQ2hDO0FBQ0E7O0FBRUE7QUFDQSxLOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSzs7QUFFQTtBQUNBO0FBQ0EsZUFBZSxhQUFhO0FBQzVCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBOztBQUVBO0FBQ0E7O0FBRUEsSztBQUNBOztBQUVBLE1BQU0saUJBQUksU0FBUyxVQUFVO0FBQzdCO0FBQ0E7O0FBRUE7QUFDQSxLOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLOztBQUVBO0FBQ0E7QUFDQSxLO0FBQ0E7O0FBRUEsTUFBTSxtQkFBTSxTQUFTLFVBQVU7QUFDL0I7QUFDQTs7QUFFQTtBQUNBLEs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUEsSzs7QUFFQTtBQUNBO0FBQ0EsZUFBZSxhQUFhO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLO0FBQ0E7O0FBRUEsTUFBTSwwQkFBYSxTQUFTLFVBQVU7QUFDdEM7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLEs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsYUFBYTtBQUNiLGVBQWUsb0JBQU87QUFDdEIsZUFBZSxvQkFBTztBQUN0QixZQUFZLGlCQUFJO0FBQ2hCLGVBQWUsb0JBQU87QUFDdEIsY0FBYyxtQkFBTTtBQUNwQixzQkFBc0IsMEJBQWE7QUFDbkMsQ0FBQyxFOztBQ3RNZTtBQUNRIiwiZmlsZSI6IjEuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8gVGV4dEVmZmVjdFxyXG4vLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuY2xhc3MgVGV4dEVmZmVjdCBleHRlbmRzIFNwcml0ZSB7XHJcbiAgICBjb25zdHJ1Y3RvcihiaXRtYXApIHtcclxuICAgICAgICBzdXBlcihiaXRtYXApO1xyXG4gICAgICAgIHRoaXMuX2lzU3RhcnRlZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuX2VmZmVjdFR5cGUgPSBcInBpbmdwb25nXCI7XHJcblxyXG4gICAgICAgIGlmKEdyYXBoaWNzLmlzV2ViR0woKSkge1xyXG4gICAgICAgICAgICB0aGlzLmZpbHRlcnMgPSBbU3ByaXRlLnZvaWRGaWx0ZXJdO1xyXG4gICAgICAgIH0gICAgICAgIFxyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZSgpIHtcclxuICAgICAgICBzdXBlci51cGRhdGUoKTtcclxuICAgICAgICB0aGlzLnVwZGF0ZUVmZmVjdHMoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOyiheujjFxyXG4gICAgICovXHJcbiAgICBmbHVzaCgpIHtcclxuICAgICAgICB0aGlzLl9pc1N0YXJ0ZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnggPSB0aGlzLl9zdGFydFg7XHJcbiAgICAgICAgdGhpcy55ID0gdGhpcy5fc3RhcnRZO1xyXG4gICAgICAgIHRoaXMucm90YXRpb24gPSB0aGlzLl9kZXNjLnJvdGF0aW9uO1xyXG4gICAgICAgIHRoaXMuc2NhbGUueCA9IHRoaXMuX2Rlc2Muc2NhbGVYO1xyXG4gICAgICAgIHRoaXMuc2NhbGUueSA9IHRoaXMuX2Rlc2Muc2NhbGVZO1xyXG4gICAgICAgIHRoaXMuc2tldy54ID0gdGhpcy5fZGVzYy5za2V3WDtcclxuICAgICAgICB0aGlzLnNrZXcueSA9IHRoaXMuX2Rlc2Muc2tld1k7XHJcbiAgICAgICAgdGhpcy50aW50ID0gdGhpcy5fZGVzYy50aW50O1xyXG4gICAgICAgIHRoaXMuZmlsdGVycyA9IHRoaXMuX2Rlc2MuZmlsdGVycztcclxuICAgICAgICB0aGlzLm9wYWNpdHkgPSB0aGlzLl90ZW1wT3BhY2l0eTtcclxuICAgICAgICB0aGlzLl9kZXNjID0ge307XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlRWZmZWN0cygpIHtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOyLnOyekVxyXG4gICAgICogQHBhcmFtIHtNVi5UZXh0U3RhdGV9IHRleHRTdGF0ZVxyXG4gICAgICovXHJcbiAgICBzdGFydCh0ZXh0U3RhdGUpIHtcclxuICAgICAgICB0aGlzLl9ub3cgPSBwZXJmb3JtYW5jZS5ub3coKTtcclxuICAgICAgICB0aGlzLl9pc1N0YXJ0ZWQgPSB0cnVlOyAgICAgICBcclxuICAgICAgICB0aGlzLl9wb3dlciA9IDE7ICAgXHJcbiAgICAgICAgdGhpcy54ID0gdGV4dFN0YXRlLng7XHJcbiAgICAgICAgdGhpcy55ID0gdGV4dFN0YXRlLnk7XHJcbiAgICAgICAgdGhpcy5fc3RhcnRYID0gdGhpcy54O1xyXG4gICAgICAgIHRoaXMuX3N0YXJ0WSA9IHRoaXMueTtcclxuICAgICAgICB0aGlzLl9yYW5kb20gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA2MCk7XHJcbiAgICAgICAgdGhpcy5faW5kZXggPSB0ZXh0U3RhdGUuaW5kZXg7XHJcbiAgICAgICAgdGhpcy5fdGVtcE9wYWNpdHkgPSB0aGlzLm9wYWNpdHk7XHJcblxyXG4gICAgICAgIHRoaXMuX2Rlc2MgPSB7XHJcbiAgICAgICAgICAgIHg6IHRoaXMueCxcclxuICAgICAgICAgICAgeTogdGhpcy55LFxyXG4gICAgICAgICAgICByb3RhdGlvbjogdGhpcy5yb3RhdGlvbiwgICAgXHJcbiAgICAgICAgICAgIHNjYWxlWDogdGhpcy5zY2FsZS54IHx8IDEuMCxcclxuICAgICAgICAgICAgc2NhbGVZOiB0aGlzLnNjYWxlLnkgfHwgMS4wLFxyXG4gICAgICAgICAgICBza2V3WCA6dGhpcy5za2V3LnggfHwgMC4wLFxyXG4gICAgICAgICAgICBza2V3WSA6dGhpcy5za2V3LnkgfHwgMC4wLFxyXG4gICAgICAgICAgICBvcGFjaXR5OiB0aGlzLm9wYWNpdHksXHJcbiAgICAgICAgICAgIHRpbnQ6IHRoaXMudGludCxcclxuICAgICAgICAgICAgZmlsdGVyczogdGhpcy5maWx0ZXJzLFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgXHJcblxyXG4gICAgfTtcclxufVxyXG5cclxuY2xhc3MgRWZmZWN0RmFjdG9yeSB7XHJcbiAgICBzdGF0aWMgY3JlYXRlKGVmZmVjdFR5cGUpIHtcclxuICAgICAgICBcclxuICAgICAgICBsZXQgc3ByaXRlO1xyXG5cclxuICAgICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKEVmZmVjdEZhY3RvcnkuVFlQRSk7XHJcblxyXG4gICAgICAgIGlmKGtleXMuY29udGFpbnMoZWZmZWN0VHlwZSkpIHtcclxuICAgICAgICAgICAgdmFyIEVUX0NMQVNTID0gRWZmZWN0RmFjdG9yeS5UWVBFW2VmZmVjdFR5cGVdO1xyXG4gICAgICAgICAgICBzcHJpdGUgPSBuZXcgRVRfQ0xBU1MoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzcHJpdGUgPSBuZXcgVGV4dEVmZmVjdCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHNwcml0ZTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGFkZCh2YWx1ZXMpIHtcclxuICAgICAgICBPYmplY3QuYXNzaWduKCBFZmZlY3RGYWN0b3J5LlRZUEUsIHZhbHVlcyApO1xyXG4gICAgfVxyXG5cclxufVxyXG5cclxuaWYoIUVmZmVjdEZhY3RvcnkuVFlQRSkge1xyXG5cclxuICAgIEVmZmVjdEZhY3RvcnkuVFlQRSA9IHtcclxuICAgIH07XHJcblxyXG4gICAgd2luZG93LkVmZmVjdEZhY3RvcnkgPSBFZmZlY3RGYWN0b3J5O1xyXG5cclxufVxyXG5cclxuZXhwb3J0IHtUZXh0RWZmZWN0LCBFZmZlY3RGYWN0b3J5fTsiLCJpbXBvcnQge1RleHRFZmZlY3QsIEVmZmVjdEZhY3Rvcnl9IGZyb20gXCIuL1RleHRFZmZlY3RcIjtcclxuXHJcbmNvbnN0IERFR19UT19SQUQgID0gKE1hdGguUEkgLyAxODAuMCk7XHJcblxyXG5jbGFzcyBQaW5nUG9uZyBleHRlbmRzIFRleHRFZmZlY3Qge1xyXG4gICAgXHJcbiAgY29uc3RydWN0b3IoYml0bWFwKSB7XHJcbiAgICAgIHN1cGVyKGJpdG1hcCk7XHJcbiAgICAgIHRoaXMuX2VmZmVjdFR5cGUgPSBcInBpbmdwb25nXCI7XHJcbiAgfVxyXG5cclxuICB1cGRhdGVFZmZlY3RzKCkge1xyXG4gICAgICBpZighdGhpcy5faXNTdGFydGVkKSByZXR1cm47ICAgICAgICAgICAgXHJcbiAgICAgIGlmKHRoaXMuX3Bvd2VyIDw9IDYwKSB7XHJcbiAgICAgICAgICB0aGlzLnkgPSB0aGlzLl9zdGFydFkgKyAoUElYSS5QSV8yIC8gdGhpcy5fcG93ZXIpICogNC4wO1xyXG4gICAgICAgICAgdGhpcy5fcG93ZXIrKztcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMuZmx1c2goKTtcclxuICAgICAgfVxyXG4gIH1cclxufSAgICBcclxuXHJcbmNsYXNzIFNsaWRlIGV4dGVuZHMgVGV4dEVmZmVjdCB7XHJcbiAgXHJcbiAgY29uc3RydWN0b3IoYml0bWFwKSB7XHJcbiAgICBzdXBlcihiaXRtYXApO1xyXG4gICAgdGhpcy5fZWZmZWN0VHlwZSA9IFwic2xpZGVcIjtcclxuICB9XHJcbiAgXHJcbiAgdXBkYXRlRWZmZWN0cygpIHtcclxuICAgIGlmKCF0aGlzLl9pc1N0YXJ0ZWQpIHJldHVybjsgICAgICAgICAgICBcclxuICAgIGlmKHRoaXMuX3Bvd2VyIDw9IDYwKSB7XHJcbiAgICAgIHRoaXMueCA9IHRoaXMuX3N0YXJ0WCArIChQSVhJLlBJXzIgLyB0aGlzLl9wb3dlcikgKiAodGhpcy5faW5kZXggJSA0KSAqIDQ7XHJcbiAgICAgIHRoaXMub3BhY2l0eSA9IDQgKiB0aGlzLl9wb3dlcjtcclxuICAgICAgdGhpcy5fcG93ZXIrKztcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuZmx1c2goKTtcclxuICAgIH1cclxuICB9XHJcbn0gICAgICAgIFxyXG5cclxuY2xhc3MgSGlnaFJvdGF0aW9uIGV4dGVuZHMgVGV4dEVmZmVjdCB7XHJcbiAgXHJcbiAgY29uc3RydWN0b3IoYml0bWFwKSB7XHJcbiAgICBzdXBlcihiaXRtYXApO1xyXG4gICAgdGhpcy5fZWZmZWN0VHlwZSA9IFwiaGlnaF9yb3RcIjtcclxuICB9XHJcbiAgXHJcbiAgdXBkYXRlRWZmZWN0cygpIHtcclxuICAgIGlmKCF0aGlzLl9pc1N0YXJ0ZWQpIHJldHVybjsgICAgICAgICAgICBcclxuICAgIGlmKHRoaXMuX3Bvd2VyIDw9IHRoaXMuX3JhbmRvbSkge1xyXG4gICAgICBsZXQgZGlzdCA9IHRoaXMuX3JhbmRvbSAtIHRoaXMuX3Bvd2VyO1xyXG4gICAgICBsZXQgdG0gPSBwZXJmb3JtYW5jZS5ub3coKTtcclxuICAgICAgbGV0IHIgPSBERUdfVE9fUkFEICogZGlzdCAqICh0aGlzLl9yYW5kb20gJSAyID09IDAgPyAtdG0gOiB0bSk7XHJcbiAgICAgIGxldCBjID0gTWF0aC5jb3Mocik7XHJcbiAgICAgIGxldCBzID0gTWF0aC5zaW4ocik7XHJcbiAgICAgIGxldCB0eCA9IHRoaXMuX3N0YXJ0WCAtIGRpc3Q7XHJcbiAgICAgIGxldCB0eSA9IHRoaXMuX3N0YXJ0WSAtIGRpc3Q7XHJcbiAgICAgIHRoaXMueCA9IHR4ICogYyAtIHR5ICogcztcclxuICAgICAgdGhpcy55ID0gdHggKiBzICsgdHkgKiBjO1xyXG4gICAgICB0aGlzLl9wb3dlcisrO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5mbHVzaCgpO1xyXG4gICAgfVxyXG4gIH1cclxufSAgICAgICAgICAgIFxyXG5cclxuY2xhc3MgTm9ybWFsUm90YXRpb24gZXh0ZW5kcyBUZXh0RWZmZWN0IHtcclxuICBcclxuICBjb25zdHJ1Y3RvcihiaXRtYXApIHtcclxuICAgIHN1cGVyKGJpdG1hcCk7XHJcbiAgICB0aGlzLl9lZmZlY3RUeXBlID0gXCJub3JtYWxfcm90XCI7XHJcbiAgfVxyXG4gIFxyXG4gIHVwZGF0ZUVmZmVjdHMoKSB7XHJcbiAgICBpZighdGhpcy5faXNTdGFydGVkKSByZXR1cm47ICAgICAgICAgICAgXHJcbiAgICBpZih0aGlzLl9wb3dlciA8PSB0aGlzLl9yYW5kb20pIHtcclxuICAgICAgbGV0IGRpc3QgPSB0aGlzLl9yYW5kb20gLSB0aGlzLl9wb3dlcjtcclxuICAgICAgbGV0IHRtID0gcGVyZm9ybWFuY2Uubm93KCk7XHJcbiAgICAgIGxldCByID0gREVHX1RPX1JBRCAqIGRpc3QgKiAodGhpcy5faW5kZXggJSAzID09IDAgPyAtMSA6IDEpO1xyXG4gICAgICBsZXQgYyA9IE1hdGguY29zKHIpO1xyXG4gICAgICBsZXQgcyA9IE1hdGguc2luKHIpO1xyXG4gICAgICBsZXQgdHggPSAodGhpcy5fc3RhcnRYIC0gZGlzdCk7XHJcbiAgICAgIGxldCB0eSA9IHRoaXMuX3N0YXJ0WSAtIGRpc3Q7XHJcbiAgICAgIHRoaXMueCA9IHR4ICogYyAtIHR5ICogcztcclxuICAgICAgdGhpcy55ID0gdHggKiBzICsgdHkgKiBjO1xyXG4gICAgICB0aGlzLl9wb3dlcisrO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5mbHVzaCgpO1xyXG4gICAgfVxyXG4gIH1cclxufSAgICAgICBcclxuXHJcbmNsYXNzIFJhbmRvbVJvdGF0aW9uIGV4dGVuZHMgVGV4dEVmZmVjdCB7XHJcbiAgXHJcbiAgY29uc3RydWN0b3IoYml0bWFwKSB7XHJcbiAgICBzdXBlcihiaXRtYXApO1xyXG4gICAgdGhpcy5fZWZmZWN0VHlwZSA9IFwicmFuZG9tX3JvdFwiO1xyXG4gIH1cclxuICBcclxuICB1cGRhdGVFZmZlY3RzKCkge1xyXG4gICAgaWYoIXRoaXMuX2lzU3RhcnRlZCkgcmV0dXJuOyAgICAgICAgICAgIFxyXG4gICAgaWYodGhpcy5fcG93ZXIgPD0gdGhpcy5fcmFuZG9tKSB7XHJcbiAgICAgIGxldCBkaXN0ID0gdGhpcy5fcmFuZG9tIC0gdGhpcy5fcG93ZXI7XHJcbiAgICAgIGxldCByID0gREVHX1RPX1JBRCAqIGRpc3QgKiAodGhpcy5fcmFuZG9tICUgMiA9PSAwID8gLTEgOiAxKTtcclxuICAgICAgbGV0IGMgPSBNYXRoLmNvcyhyKTtcclxuICAgICAgbGV0IHMgPSBNYXRoLnNpbihyKTtcclxuICAgICAgbGV0IHR4ID0gdGhpcy5fc3RhcnRYIC0gZGlzdDtcclxuICAgICAgbGV0IHR5ID0gdGhpcy5fc3RhcnRZIC0gZGlzdDtcclxuICAgICAgdGhpcy54ID0gdHggKiBjIC0gdHkgKiBzO1xyXG4gICAgICB0aGlzLnkgPSB0eCAqIHMgKyB0eSAqIGM7XHJcbiAgICAgIHRoaXMuX3Bvd2VyKys7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmZsdXNoKCk7XHJcbiAgICB9XHJcbiAgfVxyXG59ICAgICAgICAgXHJcblxyXG5jbGFzcyBTaG9jayBleHRlbmRzIFRleHRFZmZlY3Qge1xyXG4gIGNvbnN0cnVjdG9yKGJpdG1hcCkge1xyXG4gICAgc3VwZXIoYml0bWFwKTtcclxuICAgIFxyXG4gICAgdGhpcy5fZWZmZWN0VHlwZSA9IFwic2hvY2tcIjtcclxuICB9XHJcbiAgXHJcbiAgZmx1c2goKSB7XHJcbiAgICBzdXBlci5mbHVzaCgpO1xyXG4gICAgdGhpcy5yb3RhdGlvbiA9IDAuMDtcclxuICAgIHRoaXMuYW5jaG9yLnggPSAwLjA7XHJcbiAgICB0aGlzLmFuY2hvci55ID0gMC4wO1xyXG4gIH1cclxuICBcclxuICB1cGRhdGVFZmZlY3RzKCkge1xyXG4gICAgaWYoIXRoaXMuX2lzU3RhcnRlZCkgcmV0dXJuOyAgICAgIFxyXG4gICAgaWYodGhpcy5fcG93ZXIgPD0gNjApIHtcclxuICAgICAgdGhpcy5hbmNob3IueCA9IC0wLjggKyBNYXRoLnJhbmRvbSgpO1xyXG4gICAgICB0aGlzLmFuY2hvci55ID0gLTAuOCArIE1hdGgucmFuZG9tKCk7ICAgICAgICAgICAgICAgIFxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5mbHVzaCgpO1xyXG4gICAgfVxyXG4gIH1cclxuICBcclxuICBzdGFydCh0ZXh0U3RhdGUpIHtcclxuICAgIHN1cGVyLnN0YXJ0KHRleHRTdGF0ZSk7XHJcbiAgfVxyXG4gIFxyXG59ICAgIFxyXG5cclxuRWZmZWN0RmFjdG9yeS5hZGQoe1xyXG4gICdwaW5ncG9uZyc6IFBpbmdQb25nLCAgXHJcbiAgJ3NsaWRlJzogU2xpZGUsXHJcbiAgJ2hpZ2hfcm90JzogSGlnaFJvdGF0aW9uLFxyXG4gICdub3JtYWxfcm90JzogTm9ybWFsUm90YXRpb24sXHJcbiAgJ3JhbmRvbV9yb3QnOiBSYW5kb21Sb3RhdGlvbixcclxuICAnc2hvY2snOiBTaG9jaywgICAgXHJcbn0pOyIsImltcG9ydCB7VGV4dEVmZmVjdCwgRWZmZWN0RmFjdG9yeX0gZnJvbSBcIi4vVGV4dEVmZmVjdFwiO1xyXG5cclxuY2xhc3MgWm9vbU91dCBleHRlbmRzIFRleHRFZmZlY3Qge1xyXG4gICAgXHJcbiAgICBjb25zdHJ1Y3RvcihiaXRtYXApIHtcclxuICAgICAgICBzdXBlcihiaXRtYXApO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMuX2VmZmVjdFR5cGUgPSBcInpvb21vdXRcIjtcclxuICAgIH0gICAgXHJcblxyXG4gICAgdXBkYXRlRWZmZWN0cygpIHtcclxuICAgICAgICBpZighdGhpcy5faXNTdGFydGVkKSByZXR1cm47XHJcbiAgICAgICAgdGhpcy5zY2FsZS54ID0gKDIwMC4wIC0gdGhpcy5fcG93ZXIpIC8gMTAwLjA7XHJcbiAgICAgICAgdGhpcy5zY2FsZS55ID0gKDIwMC4wIC0gdGhpcy5fcG93ZXIpIC8gMTAwLjA7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYoKHRoaXMuc2NhbGUueCArIDAuMDAwMSkgPD0gMS4wKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZmx1c2goKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuX3Bvd2VyKys7XHJcbiAgICB9ICAgXHJcbiAgICBcclxuICAgIHN0YXJ0KHRleHRTdGF0ZSkge1xyXG4gICAgICAgIHN1cGVyLnN0YXJ0KHRleHRTdGF0ZSk7XHJcbiAgICAgICAgdGhpcy5zY2FsZS54ID0gMS41O1xyXG4gICAgICAgIHRoaXMuc2NhbGUueSA9IDEuNTtcclxuICAgIH0gICAgXHJcbn1cclxuXHJcbmNsYXNzIE1hcnF1ZWUgZXh0ZW5kcyBUZXh0RWZmZWN0IHtcclxuICAgIGNvbnN0cnVjdG9yKGJpdG1hcCkge1xyXG4gICAgICAgIHN1cGVyKGJpdG1hcCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdGhpcy5fZWZmZWN0VHlwZSA9IFwibWFycXVlZVwiO1xyXG4gICAgfSAgICBcclxuXHJcbiAgICB1cGRhdGVFZmZlY3RzKCkge1xyXG4gICAgICAgIGlmKCF0aGlzLl9pc1N0YXJ0ZWQpIHJldHVybjtcclxuXHJcbiAgICAgICAgdGhpcy5fb3ggLT0gNDtcclxuXHJcbiAgICAgICAgdGhpcy54ID0gdGhpcy5fc3RhcnRYICsgdGhpcy5fb3g7XHJcblxyXG4gICAgICAgIGlmKHRoaXMuX294IDwgMCkge1xyXG4gICAgICAgICAgICB0aGlzLmZsdXNoKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSAgIFxyXG4gICAgXHJcbiAgICAvKipcclxuICAgICAqIFxyXG4gICAgICogQHBhcmFtIHtNVi5UZXh0U3RhdGV9IHRleHRTdGF0ZSBcclxuICAgICAqL1xyXG4gICAgc3RhcnQodGV4dFN0YXRlKSB7XHJcbiAgICAgICAgc3VwZXIuc3RhcnQodGV4dFN0YXRlKTtcclxuXHJcbiAgICAgICAgbGV0IHdpZHRoID0gMDtcclxuICAgICAgICBsZXQgc2NlbmUgPSBTY2VuZU1hbmFnZXIuX3NjZW5lO1xyXG4gICAgICAgIGlmKHNjZW5lICYmIHNjZW5lLl9tZXNzYWdlV2luZG93KSB7XHJcbiAgICAgICAgICAgIHdpZHRoID0gc2NlbmUuX21lc3NhZ2VXaW5kb3cud2lkdGg7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgd2lkdGggPSBNYXRoLmZsb29yKEdyYXBoaWNzLmJveFdpZHRoIC8gMik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICB0aGlzLl9veCA9IHdpZHRoO1xyXG4gICAgICAgIHRoaXMueCArPSB3aWR0aDtcclxuXHJcbiAgICB9ICAgIFxyXG59XHJcblxyXG5jbGFzcyBXYXZlIGV4dGVuZHMgVGV4dEVmZmVjdCB7XHJcbiAgICBjb25zdHJ1Y3RvcihiaXRtYXApIHtcclxuICAgICAgICBzdXBlcihiaXRtYXApO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMuX2VmZmVjdFR5cGUgPSBcIndhdmVcIjtcclxuICAgIH0gICAgXHJcblxyXG4gICAgdXBkYXRlRWZmZWN0cygpIHtcclxuICAgICAgICBpZighdGhpcy5faXNTdGFydGVkKSByZXR1cm47XHJcbiAgICAgICAgdGhpcy5za2V3LnggPSA2MC4wICogTWF0aC5tYXgodGhpcy5fc3RhcnRYICUgNSwgMSk7XHJcbiAgICAgICAgdGhpcy5za2V3LnkgPSBNYXRoLnJhbmRvbSgpICogMi4wICogdGhpcy5faW5kZXg7XHJcbiAgICAgICAgaWYodGhpcy5fcG93ZXIgPj0gNjApIHtcclxuICAgICAgICAgICAgdGhpcy5mbHVzaCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLl9wb3dlcisrO1xyXG4gICAgfSAgIFxyXG4gICAgXHJcbiAgICBzdGFydCh0ZXh0U3RhdGUpIHtcclxuICAgICAgICBzdXBlci5zdGFydCh0ZXh0U3RhdGUpO1xyXG4gICAgfSAgICBcclxufVxyXG5cclxuY2xhc3MgU3ByZWFkIGV4dGVuZHMgVGV4dEVmZmVjdCB7XHJcbiAgICBjb25zdHJ1Y3RvcihiaXRtYXApIHtcclxuICAgICAgICBzdXBlcihiaXRtYXApO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMuX2VmZmVjdFR5cGUgPSBcInNwcmVhZFwiO1xyXG4gICAgfSAgICBcclxuXHJcbiAgICB1cGRhdGVFZmZlY3RzKCkge1xyXG4gICAgICAgIGlmKCF0aGlzLl9pc1N0YXJ0ZWQpIHJldHVybjtcclxuICAgICAgICBpZighKHBlcmZvcm1hbmNlLm5vdygpIC0gdGhpcy5fbGF6eSkgPj0gMTUwMCkgcmV0dXJuO1xyXG4gICAgICAgIHN3aXRjaCh0aGlzLl9pbmRleCkge1xyXG4gICAgICAgICAgICBjYXNlIDM6XHJcbiAgICAgICAgICAgICAgICB0aGlzLnggPSB0aGlzLl9zdGFydFggLSB0aGlzLl9wb3dlcjtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICAgICAgICB0aGlzLnggPSB0aGlzLl9zdGFydFggKyB0aGlzLl9wb3dlcjtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIDA6XHJcbiAgICAgICAgICAgICAgICB0aGlzLnkgPSB0aGlzLl9zdGFydFkgLSB0aGlzLl9wb3dlcjtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIDI6XHJcbiAgICAgICAgICAgICAgICB0aGlzLnkgPSB0aGlzLl9zdGFydFkgKyB0aGlzLl9wb3dlcjtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYodGhpcy5fcG93ZXIgPj0gNjAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZmx1c2goKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfSAgIFxyXG4gICAgXHJcbiAgICAvKipcclxuICAgICAqIFxyXG4gICAgICogQHBhcmFtIHtNVi5UZXh0U3RhdGV9IHRleHRTdGF0ZSBcclxuICAgICAqL1xyXG4gICAgc3RhcnQodGV4dFN0YXRlKSB7XHJcbiAgICAgICAgc3VwZXIuc3RhcnQodGV4dFN0YXRlKTtcclxuICAgICAgICB0aGlzLl9sYXp5ID0gcGVyZm9ybWFuY2Uubm93KCk7XHJcbiAgICAgICAgdGhpcy5faW5kZXggPSB0ZXh0U3RhdGUuaW5kZXggJSA0O1xyXG4gICAgfSAgICBcclxufVxyXG5cclxuY2xhc3MgTW91c2VUcmFja2luZyBleHRlbmRzIFRleHRFZmZlY3Qge1xyXG4gICAgY29uc3RydWN0b3IoYml0bWFwKSB7XHJcbiAgICAgICAgc3VwZXIoYml0bWFwKTtcclxuICAgICAgICBcclxuICAgICAgICB0aGlzLl9lZmZlY3RUeXBlID0gXCJtb3VzZV90cmFja2luZ1wiO1xyXG4gICAgfVxyXG5cclxuICAgIGdldERpc3RhbmNlKHgxLCB5MSwgeDIsIHkyKSB7XHJcbiAgICAgICAgcmV0dXJuIE1hdGguc3FydCggTWF0aC5wb3coeDIgLSB4MSwgMikgKyBNYXRoLnBvdyh5MiAtIHkxLCAyKSApO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZUVmZmVjdHMoKSB7XHJcbiAgICAgICAgaWYoIXRoaXMuX2lzU3RhcnRlZCkgcmV0dXJuO1xyXG5cclxuICAgICAgICBsZXQgbW92ZVNwZWVkID0gdGhpcy5fZGlzdCAvIDMwLjA7XHJcblxyXG4gICAgICAgIGxldCB4MSA9IHRoaXMuX3N0YXJ0WCAtIHRoaXMueDtcclxuICAgICAgICBsZXQgeTEgPSB0aGlzLl9zdGFydFkgLSB0aGlzLnk7XHJcbiAgICAgICAgbGV0IHhEaXN0ID0gMDtcclxuICAgICAgICBsZXQgeURpc3QgPSAwO1xyXG5cclxuICAgICAgICBpZih4MSA8IDApIHtcclxuICAgICAgICAgICAgeERpc3QgPSBtb3ZlU3BlZWQ7XHJcbiAgICAgICAgfSBlbHNlIGlmKHgxID4gMCkge1xyXG4gICAgICAgICAgICB4RGlzdCA9IC1tb3ZlU3BlZWQ7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgeERpc3QgPSAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYoeTEgPCAwKSB7XHJcbiAgICAgICAgICAgIHlEaXN0ID0gbW92ZVNwZWVkO1xyXG4gICAgICAgIH0gZWxzZSBpZih5MSA+IDApIHtcclxuICAgICAgICAgICAgeURpc3QgPSAtbW92ZVNwZWVkO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHlEaXN0ID0gMDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCB0eCA9IHRoaXMueCAtIHhEaXN0O1xyXG4gICAgICAgIGxldCB0eSA9IHRoaXMueSAtIHlEaXN0O1xyXG5cclxuICAgICAgICB0aGlzLnggPSB0eDtcclxuICAgICAgICB0aGlzLnkgPSB0eTtcclxuXHJcbiAgICAgICAgbGV0IGRpc3QgPSBNYXRoLmZsb29yKHRoaXMuZ2V0RGlzdGFuY2UodGhpcy5fc3RhcnRYLCB0aGlzLl9zdGFydFksIFRvdWNoSW5wdXQueCwgVG91Y2hJbnB1dC55KSk7XHJcbiAgICAgICAgaWYoZGlzdCA8IDE2KSB7XHJcbiAgICAgICAgICAgIHRoaXMuZmx1c2goKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfSAgIFxyXG4gICAgXHJcbiAgICBzdGFydCh0ZXh0U3RhdGUpIHtcclxuICAgICAgICBzdXBlci5zdGFydCh0ZXh0U3RhdGUpO1xyXG4gICAgICAgIHRoaXMueCA9IFRvdWNoSW5wdXQueDtcclxuICAgICAgICB0aGlzLnkgPSBUb3VjaElucHV0Lnk7XHJcbiAgICAgICAgdGhpcy5fZGlzdCA9IE1hdGguZmxvb3IodGhpcy5nZXREaXN0YW5jZSh0aGlzLl9zdGFydFgsIHRoaXMuX3N0YXJ0WSwgVG91Y2hJbnB1dC54LCBUb3VjaElucHV0LnkpKTtcclxuICAgIH1cclxufVxyXG5cclxuRWZmZWN0RmFjdG9yeS5hZGQoe1xyXG4gICAgXCJ6b29tb3V0XCI6IFpvb21PdXQsXHJcbiAgICBcIm1hcnF1ZWVcIjogTWFycXVlZSxcclxuICAgIFwid2F2ZVwiOiBXYXZlLFxyXG4gICAgXCJ6b29tb3V0XCI6IFpvb21PdXQsXHJcbiAgICBcInNwcmVhZFwiOiBTcHJlYWQsXHJcbiAgICBcIm1vdXNlX3RyYWNraW5nXCI6IE1vdXNlVHJhY2tpbmcsXHJcbn0pOyIsImltcG9ydCBcIi4vY29yZVwiO1xyXG5pbXBvcnQgXCIuL0VmZmVjdHNQYWNrMVwiO1xyXG5pbXBvcnQgXCIuL0VmZmVjdHNQYWNrMlwiOyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///1\n')}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiXSwibmFtZXMiOlsiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJpIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsInQiLCJtb2RlIiwiX19lc01vZHVsZSIsIm5zIiwiY3JlYXRlIiwia2V5IiwiYmluZCIsIm4iLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiXSwibWFwcGluZ3MiOiJhQUNFLElBQUlBLEVBQW1CLEdBR3ZCLFNBQVNDLEVBQW9CQyxHQUc1QixHQUFHRixFQUFpQkUsR0FDbkIsT0FBT0YsRUFBaUJFLEdBQVVDLFFBR25DLElBQUlDLEVBQVNKLEVBQWlCRSxHQUFZLENBQ3pDRyxFQUFHSCxFQUNISSxHQUFHLEVBQ0hILFFBQVMsSUFVVixPQU5BSSxFQUFRTCxHQUFVTSxLQUFLSixFQUFPRCxRQUFTQyxFQUFRQSxFQUFPRCxRQUFTRixHQUcvREcsRUFBT0UsR0FBSSxFQUdKRixFQUFPRCxRQUtmRixFQUFvQlEsRUFBSUYsRUFHeEJOLEVBQW9CUyxFQUFJVixFQUd4QkMsRUFBb0JVLEVBQUksU0FBU1IsRUFBU1MsRUFBTUMsR0FDM0NaLEVBQW9CYSxFQUFFWCxFQUFTUyxJQUNsQ0csT0FBT0MsZUFBZWIsRUFBU1MsRUFBTSxDQUFFSyxZQUFZLEVBQU1DLElBQUtMLEtBS2hFWixFQUFvQmtCLEVBQUksU0FBU2hCLEdBQ1gsb0JBQVhpQixRQUEwQkEsT0FBT0MsYUFDMUNOLE9BQU9DLGVBQWViLEVBQVNpQixPQUFPQyxZQUFhLENBQUVDLE1BQU8sV0FFN0RQLE9BQU9DLGVBQWViLEVBQVMsYUFBYyxDQUFFbUIsT0FBTyxLQVF2RHJCLEVBQW9Cc0IsRUFBSSxTQUFTRCxFQUFPRSxHQUV2QyxHQURVLEVBQVBBLElBQVVGLEVBQVFyQixFQUFvQnFCLElBQy9CLEVBQVBFLEVBQVUsT0FBT0YsRUFDcEIsR0FBVyxFQUFQRSxHQUE4QixpQkFBVkYsR0FBc0JBLEdBQVNBLEVBQU1HLFdBQVksT0FBT0gsRUFDaEYsSUFBSUksRUFBS1gsT0FBT1ksT0FBTyxNQUd2QixHQUZBMUIsRUFBb0JrQixFQUFFTyxHQUN0QlgsT0FBT0MsZUFBZVUsRUFBSSxVQUFXLENBQUVULFlBQVksRUFBTUssTUFBT0EsSUFDdEQsRUFBUEUsR0FBNEIsaUJBQVRGLEVBQW1CLElBQUksSUFBSU0sS0FBT04sRUFBT3JCLEVBQW9CVSxFQUFFZSxFQUFJRSxFQUFLLFNBQVNBLEdBQU8sT0FBT04sRUFBTU0sSUFBUUMsS0FBSyxLQUFNRCxJQUM5SSxPQUFPRixHQUlSekIsRUFBb0I2QixFQUFJLFNBQVMxQixHQUNoQyxJQUFJUyxFQUFTVCxHQUFVQSxFQUFPcUIsV0FDN0IsV0FBd0IsT0FBT3JCLEVBQWdCLFNBQy9DLFdBQThCLE9BQU9BLEdBRXRDLE9BREFILEVBQW9CVSxFQUFFRSxFQUFRLElBQUtBLEdBQzVCQSxHQUlSWixFQUFvQmEsRUFBSSxTQUFTaUIsRUFBUUMsR0FBWSxPQUFPakIsT0FBT2tCLFVBQVVDLGVBQWUxQixLQUFLdUIsRUFBUUMsSUFHekcvQixFQUFvQmtDLEVBQUksR0FJakJsQyxFQUFvQkEsRUFBb0JtQyxFQUFJLEciLCJmaWxlIjoiUlNfTWVzc2FnZUVmZmVjdHMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMSk7XG4iXSwic291cmNlUm9vdCI6IiJ9